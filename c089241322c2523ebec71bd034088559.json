{"posts": [{"title": "Hello World!", "date": "2019-12-18T16:50:00-00.00", "path": "/HeapStack/archives/typography/", "text": "\u8fd9\u662f\u4e00\u7bc7\u793a\u4f8b\u6587\u7ae0\uff0c\u5728\u8fd9\u91cc\u4f60\u53ef\u4ee5\u770b\u5230\u5e38\u7528\u9875\u9762\u5143\u7d20\u7684\u663e\u793a\u6548\u679c\uff0c\u540c\u65f6\u4e5f\u662f Markdown \u8bed\u6cd5\u7684\u53c2\u8003\u6587\u7ae0\u3002\u4fdd\u7559\u6216\u8005\u5220\u9664\u672c\u6587\uff0c\u5f00\u59cb\u81ea\u5df1\u7684\u521b\u4f5c\u5427\uff01L2 Heading\nL3 Heading\nL4 Heading\nL5 Heading\nL6 Heading\nParagraph\nWe are creating a world that all may enter without privilege or prejudice accorded by race, economic power, military force, or station of birth.\nWe are creating a world where anyone, anywhere may express his or her beliefs, no matter how singular, without fear of being coerced into silence or conformity.\nInline elements\nBold, Ruby(\u30eb\u30d3), Italic, Strikethrough, Link1\u3002\nBlockquote and nested blockquote\n\u5b89\u5f97\u5e7f\u53a6\u5343\u4e07\u95f4\uff0c\u5927\u5e87\u5929\u4e0b\u5bd2\u58eb\u4ff1\u6b22\u989c\uff01\u98ce\u96e8\u4e0d\u52a8\u5b89\u5982\u5c71\u3002\n\u545c\u547c\uff01\u4f55\u65f6\u773c\u524d\u7a81\u5140\u89c1\u6b64\u5c4b\uff0c\u543e\u5e90\u72ec\u7834\u53d7\u51bb\u6b7b\u4ea6\u8db3\uff01\n\n\nCode\nInline code: int a=1;. Code block:\nint main(int argc , char** argv){\n    std::cout &lt;&lt; &quot;Hello World!\\n&quot;;\n    return 0;\n}\n\nList\nUnordered List\n\niPhone\niPhone X\niPhone 11\n\n\niPad\nMacBook\n\nOrdered List\n\n\u6253\u5f00\u51b0\u7bb1\n\u53f3\u624b\u653e\u5728\u51b0\u7bb1\u95e8\u62c9\u624b\u4e0a\n\u5de6\u624b\u6276\u4f4f\u51b0\u7bb1\u4e3b\u4f53\n\u53f3\u624b\u5411\u540e\u7528\u529b\n\n\n\u628a\u5927\u8c61\u653e\u8fdb\u51b0\u7bb1\n\u5173\u4e0a\u51b0\u7bb1\n\nHorizontal rule\n\nMath\nInline Math: $m\\times n$, math block:\n$$C_{m\\times k}=A_{m\\times n}\\cdot B_{n\\times k}$$\nFigures\nSingle figure\nPrincess Mononoke\nPhotoset\n\n\n\n\n\n\nTable\n\n\nheader\nheader\n\n\n\n\ncell 1\ncell 2\n\n\ncell 3\ncell 4\n\n\n\nLink Card\n\n                                  AlanDecodeHome page for AlanDecode \u21a9", "categories": [{"name": "Maverick", "slug": "Maverick", "permalink": "/HeapStack/category/Maverick/"}], "tags": [{"name": "Design", "slug": "Design", "permalink": "/HeapStack/tag/Design/"}, {"name": "Typography", "slug": "Typography", "permalink": "/HeapStack/tag/Typography/"}]}, {"title": "A interesting story", "date": "2019-12-11T16:08:00-00.00", "path": "/HeapStack/archives/a-interesting-story/", "text": "Mycat\u57fa\u4e8e\u963f\u91cc\u5f00\u6e90\u7684Cobar\u4ea7\u54c1\u800c\u7814\u53d1\u3002Mycat \u662f\u6570\u636e\u5e93\u4e2d\u95f4\u4ef6 \u3002\n\u4e0b\u8f7d\u5730\u5740\uff1ahttp://www.mycat.io/\n\u7406\u8bba\n\u4ec0\u4e48\u662f\u4e2d\u95f4\u4ef6\n\u4e2d\u95f4\u4ef6\uff1a \u662f\u4e00\u7c7b\u8fde\u63a5\u8f6f\u4ef6\u7ec4\u4ef6\u548c\u5e94\u7528\u7684\u8ba1\u7b97\u673a\u8f6f\u4ef6\uff0c \u4ee5\u4fbf\u4e8e\u8f6f\u4ef6\u5404\u90e8\u4ef6\u4e4b\u95f4\u7684\u6c9f\u901a\u3002\n\u4f8b\u5b50\uff1a Tomcat\uff0c web\u4e2d\u95f4\u4ef6\u3002\n\u6570\u636e\u5e93\u4e2d\u95f4\u4ef6\uff1a \u8fde\u63a5java\u5e94\u7528\u7a0b\u5e8f\u548c\u6570\u636e\u5e93\n\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528Myat\n\nJava\u4e0e\u6570\u636e\u5e93\u7d27\u8026\u5408\u3002\n\u9ad8\u8bbf\u95ee\u91cf\u9ad8\u5e76\u53d1\u5bf9\u6570\u636e\u5e93\u7684\u538b\u529b\u3002\n\u8bfb\u5199\u8bf7\u6c42\u6570\u636e\u4e0d\u4e00\u81f4\n\nMycat\u67b6\u6784\u56fe\narc\n\u80fd\u5e72\u4ec0\u4e48\n\n\u8bfb\u5199\u5206\u79bb \uff1a\nMycat\u4f5c\u4e3a\u4e2d\u95f4\u4ef6\uff0cMycat\u628a\u5199\u8bf7\u6c42\u53d1\u9001\u4e3b\u4e3b\u673amaster\uff0c\u8bfb\u8bf7\u6c42\u53d1\u9001\u4e2a\u4ece\u4e3b\u673aslave\u3002\u4e3b\u4e3b\u673a\u548c\u4ece\u4e3b\u673a\u4e4b\u95f4\u8fdb\u884cMysql\u7684\u4e3b\u4ece\u590d\u5236\u3002\u4ece\u4e3b\u673a\u590d\u5236\u4e3b\u4e3b\u673a\u3002\n\n\u6570\u636e\u5206\u7247 \uff1a\u5782\u76f4\u62c6\u5206\uff08\u5206\u5e93\uff09 \u3001 \u6c34\u5e73\u62c6\u5206\uff08\u5206\u8868\uff09 \u3001 \u5782\u76f4+\u6c34\u5e73\u62c6\u5206\uff08\u5206\u5e93\u5206\u8868\uff09\n\n\u591a\u6570\u636e\u6e90\u6574\u5408 \uff1a\u652f\u6301\u5404\u79cd\u6570\u636e\u5e93\u3002\nmycat2\n\u539f\u7406\nMycat \u7684\u539f\u7406\u4e2d\u6700\u91cd\u8981\u7684\u4e00\u4e2a\u52a8\u8bcd\u662f\u201c\u62e6\u622a\u201d\uff0c\u5b83\u62e6\u622a\u4e86\u7528\u6237\u53d1\u9001\u8fc7\u6765\u7684 SQL \u8bed\u53e5\uff0c\u9996\u5148\u5bf9 SQL\n\u8bed\u53e5\u505a\u4e86\u4e00\u4e9b\u7279\u5b9a\u7684\u5206\u6790\uff1a\u5982\u5206\u7247\u5206\u6790\u3001\u8def\u7531\u5206\u6790\u3001\u8bfb\u5199\u5206\u79bb\u5206\u6790\u3001\u7f13\u5b58\u5206\u6790\u7b49\uff0c\u7136\u540e\u5c06\u6b64 SQL \u53d1\u5f80\u540e\u7aef\u7684\u771f\u5b9e\u6570\u636e\u5e93\uff0c \u5e76\u5c06\u8fd4\u56de\u7684\u7ed3\u679c\u505a\u9002\u5f53\u7684\u5904\u7406\uff0c\u6700\u7ec8\u518d\u8fd4\u56de\u7ed9\u7528\u6237\u3002\n\n\n2020-02-14_152450\n\u5b89\u88c5Mycat\n\u7531\u4e8eMycat\u4e0b\u8f7d\u7684\u5373\u53ef\u4f7f\u7528\n\u4e0b\u8f7d\uff1aMycat-server-1.6.7.1-release-20190627191042-linux.tar.gz \u5b89\u88c5\u5305\u3002\u5730\u5740\uff1ahttp://dl.mycat.io/\n\n wget http://dl.mycat.io/1.6.7.1/Mycat-server-1.6.7.1-release-20190627191042-linux.tar.gz\n tar -xzvf  Mycat-server-1.6.7.1-release-20190627191042-linux.tar.gz -C /usr/local/\n\u76ee\u5f55\u7ed3\u6784\n--bin \u542f\u52a8\u76ee\u5f55\n--conf \u914d\u7f6e\u76ee\u5f55\u5b58\u653e\u914d\u7f6e\u6587\u4ef6\uff1a\n\n  --server.xml\uff1a\u662fMycat\u670d\u52a1\u5668\u53c2\u6570\u8c03\u6574\u548c\u7528\u6237\u6388\u6743\u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\n  --schema.xml\uff1a\u662f\u903b\u8f91\u5e93\u5b9a\u4e49\u548c\u8868\u4ee5\u53ca\u5206\u7247\u5b9a\u4e49\u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\n  --rule.xml\uff1a  \u662f\u5206\u7247\u89c4\u5219\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5206\u7247\u89c4\u5219\u7684\u5177\u4f53\u4e00\u4e9b\u53c2\u6570\u4fe1\u606f\u5355\u72ec\u5b58\u653e\u4e3a\u6587\u4ef6\uff0c\u4e5f\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e0b\uff0c\u914d\u7f6e\u6587\u4ef6\u4fee\u6539\u9700\u8981\u91cd\u542fMyCAT\u3002\n\n  --log4j.xml\uff1a \u65e5\u5fd7\u5b58\u653e\u5728logs/log\u4e2d\uff0c\u6bcf\u5929\u4e00\u4e2a\u6587\u4ef6\uff0c\u65e5\u5fd7\u7684\u914d\u7f6e\u662f\u5728conf/log4j.xml\u4e2d\uff0c\u6839\u636e\u81ea\u5df1\u7684\u9700\u8981\u53ef\u4ee5\u8c03\u6574\u8f93\u51fa\u7ea7\u522b\u4e3adebug \uff0cdebug\u7ea7\u522b\u4e0b\uff0c\u4f1a\u8f93\u51fa\u66f4\u591a\u7684\u4fe1\u606f\uff0c\u65b9\u4fbf\u6392\u67e5\u95ee\u9898\u3002\n\n  --autopartition-long.txt,partition-hash-int.txt,sequence_conf.properties\uff0c sequence_db_conf.properties \u5206\u7247\u76f8\u5173\u7684id\u5206\u7247\u89c4\u5219\u914d\u7f6e\u6587\u4ef6\n\n  --lib     MyCAT\u81ea\u8eab\u7684jar\u5305\u6216\u4f9d\u8d56\u7684jar\u5305\u7684\u5b58\u653e\u76ee\u5f55\u3002\n  --logs        MyCAT\u65e5\u5fd7\u7684\u5b58\u653e\u76ee\u5f55\u3002\u65e5\u5fd7\u5b58\u653e\u5728logs/log\u4e2d\uff0c\u6bcf\u5929\u4e00\u4e2a\u6587\u4ef6\nMycat\u53c2\u8003\u547d\u4ee4:\nlinux\n\n./mycat start \u542f\u52a8\n\n./mycat stop \u505c\u6b62\n\n./mycat console \u524d\u53f0\u8fd0\u884c\n\n./mycat install \u6dfb\u52a0\u5230\u7cfb\u7edf\u81ea\u52a8\u542f\u52a8\uff08\u6682\u672a\u5b9e\u73b0\uff09\n\n./mycat remove \u53d6\u6d88\u968f\u7cfb\u7edf\u81ea\u52a8\u542f\u52a8\uff08\u6682\u672a\u5b9e\u73b0\uff09\n\n./mycat restart \u91cd\u542f\u670d\u52a1\n\n./mycat pause \u6682\u505c\n\n./mycat status \u67e5\u770b\u542f\u52a8\u72b6\u6001\n\u82e5\u9700\u8981\u4fee\u6539Mycat\u7684Jvm\u914d\u7f6e\u53c2\u6570\uff0c\u6253\u5f00conf/wrapper.conf\u6587\u4ef6\u4fee\u6539\u5373\u53ef\u3002Mycat\u7684\u8fde\u63a5\u65b9\u5f0f\u548cMysql\u8fde\u63a5\u65b9\u5f0f\u4e00\u6837\u3002\u4f8b\u5982\uff1a\nmysql -uroot -proot -P8066 -h127.0.0.1   #\u542f\u52a8\u524d\u9700\u8981\u4fee\u6539Mycat\u7684\u914d\u7f6e\u6587\u4ef6\n\n\u914d\u7f6e\u56fe\uff1a\ntable\nServerl.xml:\n\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;!DOCTYPE mycat:server SYSTEM \"server.dtd\"&gt;\n&lt;mycat:server xmlns:mycat=\"http://io.mycat/\"&gt;\n    &lt;system&gt;\n    &lt;property name=\"nonePasswordLogin\"&gt;0&lt;/property&gt; &lt;!-- 0\u4e3a\u9700\u8981\u5bc6\u7801\u767b\u9646\u30011\u4e3a\u4e0d\u9700\u8981\u5bc6\u7801\u767b\u9646 ,\u9ed8\u8ba4\u4e3a0\uff0c\u8bbe\u7f6e\u4e3a1\u5219\u9700\u8981\u6307\u5b9a\u9ed8\u8ba4\u8d26\u6237--&gt;\n    &lt;property name=\"useHandshakeV10\"&gt;1&lt;/property&gt;\n    &lt;property name=\"useSqlStat\"&gt;0&lt;/property&gt;  &lt;!-- 1\u4e3a\u5f00\u542f\u5b9e\u65f6\u7edf\u8ba1\u30010\u4e3a\u5173\u95ed --&gt;\n    &lt;property name=\"useGlobleTableCheck\"&gt;0&lt;/property&gt;  &lt;!-- 1\u4e3a\u5f00\u542f\u5168\u52a0\u73ed\u4e00\u81f4\u6027\u68c0\u6d4b\u30010\u4e3a\u5173\u95ed --&gt;\n    &lt;property name=\"sequnceHandlerType\"&gt;2&lt;/property&gt;\n    &lt;!--\u5fc5\u987b\u5e26\u6709MYCATSEQ_\u6216\u8005 mycatseq_\u8fdb\u5165\u5e8f\u5217\u5339\u914d\u6d41\u7a0b \u6ce8\u610fMYCATSEQ_\u6709\u7a7a\u683c\u7684\u60c5\u51b5--&gt;\n    &lt;property name=\"sequnceHandlerPattern\"&gt;(?:(\\s*next\\s+value\\s+for\\s*MYCATSEQ_(\\w+))(,|\\)|\\s)*)+&lt;/property&gt;\n    &lt;property name=\"subqueryRelationshipCheck\"&gt;false&lt;/property&gt; &lt;!-- \u5b50\u67e5\u8be2\u4e2d\u5b58\u5728\u5173\u8054\u67e5\u8be2\u7684\u60c5\u51b5\u4e0b,\u68c0\u67e5\u5173\u8054\u5b57\u6bb5\u4e2d\u662f\u5426\u6709\u5206\u7247\u5b57\u6bb5 .\u9ed8\u8ba4 false --&gt;\n  &lt;!--&lt;property name=\"useCompression\"&gt;1&lt;/property&gt;--&gt; &lt;!--1\u4e3a\u5f00\u542fmysql\u538b\u7f29\u534f\u8bae--&gt;\n  &lt;!-- &lt;property name=\"fakeMySQLVersion\"&gt;5.6.20&lt;/property&gt;--&gt; &lt;!--\u8bbe\u7f6e\u6a21\u62df\u7684MySQL\u7248\u672c\u53f7--&gt;\n  &lt;!-- &lt;property name=\"processorBufferChunk\"&gt;40960&lt;/property&gt; --&gt;\n  &lt;!-- &lt;property name=\"processors\"&gt;1&lt;/property&gt; \n      &lt;property name=\"processorExecutor\"&gt;32&lt;/property&gt; \n  --&gt;\n   &lt;!--\u9ed8\u8ba4\u4e3atype 0: DirectByteBufferPool | type 1 ByteBufferArena | type 2 NettyBufferPool --&gt;\n    &lt;property name=\"processorBufferPoolType\"&gt;0&lt;/property&gt;\n        &lt;!--\u9ed8\u8ba4\u662f65535 64K \u7528\u4e8esql\u89e3\u6790\u65f6\u6700\u5927\u6587\u672c\u957f\u5ea6 --&gt;\n        &lt;!--&lt;property name=\"maxStringLiteralLength\"&gt;65535&lt;/property&gt;--&gt;\n        &lt;!--&lt;property name=\"sequnceHandlerType\"&gt;0&lt;/property&gt;--&gt;\n        &lt;!--&lt;property name=\"backSocketNoDelay\"&gt;1&lt;/property&gt;--&gt;\n        &lt;!--&lt;property name=\"frontSocketNoDelay\"&gt;1&lt;/property&gt;--&gt;\n        &lt;!--&lt;property name=\"processorExecutor\"&gt;16&lt;/property&gt;--&gt;\n        &lt;!--\n        &lt;property name=\"serverPort\"&gt;8066&lt;/property&gt; &lt;property name=\"managerPort\"&gt;9066&lt;/property&gt; \n        &lt;property name=\"idleTimeout\"&gt;300000&lt;/property&gt; &lt;property name=\"bindIp\"&gt;0.0.0.0&lt;/property&gt; \n        &lt;property name=\"frontWriteQueueSize\"&gt;4096&lt;/property&gt; &lt;property name=\"processors\"&gt;32&lt;/property&gt; --&gt;\n        &lt;!--\u5206\u5e03\u5f0f\u4e8b\u52a1\u5f00\u5173\uff0c0\u4e3a\u4e0d\u8fc7\u6ee4\u5206\u5e03\u5f0f\u4e8b\u52a1\uff0c1\u4e3a\u8fc7\u6ee4\u5206\u5e03\u5f0f\u4e8b\u52a1\uff08\u5982\u679c\u5206\u5e03\u5f0f\u4e8b\u52a1\u5185\u53ea\u6d89\u53ca\u5168\u5c40\u8868\uff0c\u5219\u4e0d\u8fc7\u6ee4\uff09\uff0c2\u4e3a\u4e0d\u8fc7\u6ee4\u5206\u5e03\u5f0f\u4e8b\u52a1,\u4f46\u662f\u8bb0\u5f55\u5206\u5e03\u5f0f\u4e8b\u52a1\u65e5\u5fd7--&gt;\n        &lt;property name=\"handleDistributedTransactions\"&gt;0&lt;/property&gt;\n        &lt;!--  off heap for merge/order/group/limit      1\u5f00\u542f   0\u5173\u95ed   --&gt;\n        &lt;property name=\"useOffHeapForMerge\"&gt;0&lt;/property&gt;\n\n        &lt;!--   \u5355\u4f4d\u4e3am    --&gt;\n        &lt;property name=\"memoryPageSize\"&gt;64k&lt;/property&gt;\n\n        &lt;!--    \u5355\u4f4d\u4e3ak    --&gt;\n        &lt;property name=\"spillsFileBufferSize\"&gt;1k&lt;/property&gt;\n\n        &lt;property name=\"useStreamOutput\"&gt;0&lt;/property&gt;\n\n        &lt;!--    \u5355\u4f4d\u4e3am   --&gt;\n        &lt;property name=\"systemReserveMemorySize\"&gt;384m&lt;/property&gt;\n\n        &lt;!--\u662f\u5426\u91c7\u7528zookeeper\u534f\u8c03\u5207\u6362  --&gt;\n        &lt;property name=\"useZKSwitch\"&gt;false&lt;/property&gt;\n\n        &lt;!-- XA Recovery Log\u65e5\u5fd7\u8def\u5f84 --&gt;\n        &lt;!--&lt;property name=\"XARecoveryLogBaseDir\"&gt;./&lt;/property&gt;--&gt;\n\n        &lt;!-- XA Recovery Log\u65e5\u5fd7\u540d\u79f0 --&gt;\n        &lt;!--&lt;property name=\"XARecoveryLogBaseName\"&gt;tmlog&lt;/property&gt;--&gt;\n        &lt;!--\u5982\u679c\u4e3a true\u7684\u8bdd \u4e25\u683c\u9075\u5b88\u9694\u79bb\u7ea7\u522b,\u4e0d\u4f1a\u5728\u4ec5\u4ec5\u53ea\u6709select\u8bed\u53e5\u7684\u65f6\u5019\u5728\u4e8b\u52a1\u4e2d\u5207\u6362\u8fde\u63a5--&gt;\n        &lt;property name=\"strictTxIsolation\"&gt;false&lt;/property&gt;\n\n        &lt;property name=\"useZKSwitch\"&gt;true&lt;/property&gt;\n\n    &lt;/system&gt;\n\n    &lt;!-- \u5168\u5c40SQL\u9632\u706b\u5899\u8bbe\u7f6e --&gt;\n    &lt;!--\u767d\u540d\u5355\u53ef\u4ee5\u4f7f\u7528\u901a\u914d\u7b26%\u6216\u7740*--&gt;\n    &lt;!--\u4f8b\u5982&lt;host host=\"127.0.0.*\" user=\"root\"/&gt;--&gt;\n    &lt;!--\u4f8b\u5982&lt;host host=\"127.0.*\" user=\"root\"/&gt;--&gt;\n    &lt;!--\u4f8b\u5982&lt;host host=\"127.*\" user=\"root\"/&gt;--&gt;\n    &lt;!--\u4f8b\u5982&lt;host host=\"1*7.*\" user=\"root\"/&gt;--&gt;\n    &lt;!--\u8fd9\u4e9b\u914d\u7f6e\u60c5\u51b5\u4e0b\u5bf9\u4e8e127.0.0.1\u90fd\u80fd\u4ee5root\u8d26\u6237\u767b\u5f55--&gt;\n    &lt;!--\n    &lt;firewall&gt;\n       &lt;whitehost&gt;\n          &lt;host host=\"1*7.0.0.*\" user=\"root\"/&gt;\n       &lt;/whitehost&gt;\n       &lt;blacklist check=\"false\"&gt;\n       &lt;/blacklist&gt;\n    &lt;/firewall&gt;\n    --&gt;\n\n    &lt;user name=\"root\" defaultAccount=\"true\"&gt;\n        &lt;property name=\"password\"&gt;123456&lt;/property&gt;\n        &lt;property name=\"schemas\"&gt;TESTDB&lt;/property&gt;\n\n        &lt;!-- \u8868\u7ea7 DML \u6743\u9650\u8bbe\u7f6e --&gt;\n        &lt;!--        \n        &lt;privileges check=\"false\"&gt;\n            &lt;schema name=\"TESTDB\" dml=\"0110\" &gt;\n                &lt;table name=\"tb01\" dml=\"0000\"&gt;&lt;/table&gt;\n                &lt;table name=\"tb02\" dml=\"1111\"&gt;&lt;/table&gt;\n            &lt;/schema&gt;\n        &lt;/privileges&gt;       \n         --&gt;\n    &lt;/user&gt;\n\n    &lt;user name=\"user\"&gt;\n        &lt;property name=\"password\"&gt;user&lt;/property&gt;\n        &lt;property name=\"schemas\"&gt;TESTDB&lt;/property&gt;\n        &lt;property name=\"readOnly\"&gt;true&lt;/property&gt;\n    &lt;/user&gt;\n\n&lt;/mycat:server&gt;\n\u4e0a\u9762\u4e3b\u8981\u662f\uff1a\n\nsystem \u53c2\u6570\u662f\u6240\u6709\u7684mycat\u53c2\u6570\u914d\u7f6e\uff0c\nuser \u662f\u7528\u6237\u53c2\u6570\u3002\nfirewall\uff1a\u7528\u6765\u5b9a\u4e49\u9632\u706b\u5899\uff1b firewall \u4e0b whitehost \u6807\u7b7e\u7528\u6765\u5b9a\u4e49 IP \u767d\u540d\u5355 \uff0c blacklist \u7528\u6765\u5b9a\u4e49\nSQL \u9ed1\u540d\u5355\u3002 \n\nschema.xml\n&lt;?xml version=&quot;1.0&quot;?&gt;\n&lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;\n&lt;mycat:schema xmlns:mycat=&quot;http://io.mycat/&quot;&gt;\n\n    &lt;schema name=&quot;TESTDB&quot; checkSQLschema=&quot;false&quot; sqlMaxLimit=&quot;100&quot;&gt;\n        &lt;table name=&quot;travelrecord&quot; dataNode=&quot;dn1,dn2,dn3&quot; rule=&quot;auto-sharding-long&quot; /&gt;\n        &lt;table name=&quot;company&quot; primaryKey=&quot;ID&quot; type=&quot;global&quot; dataNode=&quot;dn1,dn2,dn3&quot; /&gt;\n        &lt;table name=&quot;goods&quot; primaryKey=&quot;ID&quot; type=&quot;global&quot; dataNode=&quot;dn1,dn2&quot; /&gt;\n        &lt;table name=&quot;hotnews&quot; primaryKey=&quot;ID&quot; autoIncrement=&quot;true&quot; dataNode=&quot;dn1,dn2,dn3&quot;\n               rule=&quot;mod-long&quot; /&gt;\n        &lt;table name=&quot;employee&quot; primaryKey=&quot;ID&quot; dataNode=&quot;dn1,dn2&quot;\n               rule=&quot;sharding-by-intfile&quot; /&gt;\n        &lt;table name=&quot;customer&quot; primaryKey=&quot;ID&quot; dataNode=&quot;dn1,dn2&quot;\n               rule=&quot;sharding-by-intfile&quot;&gt;\n            &lt;childTable name=&quot;orders&quot; primaryKey=&quot;ID&quot; joinKey=&quot;customer_id&quot;\n                        parentKey=&quot;id&quot;&gt;\n                &lt;childTable name=&quot;order_items&quot; joinKey=&quot;order_id&quot;\n                            parentKey=&quot;id&quot; /&gt;\n            &lt;/childTable&gt;\n            &lt;childTable name=&quot;customer_addr&quot; primaryKey=&quot;ID&quot; joinKey=&quot;customer_id&quot;\n                        parentKey=&quot;id&quot; /&gt;\n        &lt;/table&gt;\n    &lt;/schema&gt;\n    &lt;dataNode name=&quot;dn1&quot; dataHost=&quot;localhost1&quot; database=&quot;db1&quot; /&gt;\n    &lt;dataNode name=&quot;dn2&quot; dataHost=&quot;localhost1&quot; database=&quot;db2&quot; /&gt;\n    &lt;dataNode name=&quot;dn3&quot; dataHost=&quot;localhost1&quot; database=&quot;db3&quot; /&gt;\n    &lt;dataHost name=&quot;localhost1&quot; maxCon=&quot;1000&quot; minCon=&quot;10&quot; balance=&quot;0&quot;  writeType=&quot;0&quot; dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; switchType=&quot;1&quot;  slaveThreshold=&quot;100&quot;&gt;\n        &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;\n        &lt;writeHost host=&quot;hostM1&quot; url=&quot;localhost:3306&quot; user=&quot;root&quot;  password=&quot;123456&quot;&gt;\n            &lt;readHost host=&quot;hostS2&quot; url=&quot;192.168.1.200:3306&quot; user=&quot;root&quot; password=&quot;xxx&quot; /&gt;\n        &lt;/writeHost&gt;\n        &lt;writeHost host=&quot;hostS1&quot; url=&quot;localhost:3316&quot; user=&quot;root&quot;  password=&quot;123456&quot; /&gt;\n    &lt;/dataHost&gt;\n\n&lt;/mycat:schema&gt;\n\n\u4e0a\u9762schema \u662f\u5b9e\u9645\u903b\u8f91\u5e93\u7684\u914d\u7f6e\uff0c\u591a\u4e2aschema\u4ee3\u8868\u591a\u4e2a\u903b\u8f91\u5e93\u3002dataNode\u662f\u903b\u8f91\u5e93\u5bf9\u5e94\u7684\u5206\u7247\uff0c\u5982\u679c\u914d\u7f6e\u591a\u4e2a\u5206\u7247\u53ea\u9700\u8981\u591a\u4e2adataNode\u5373\u53ef\u3002dataHost\u662f\u5b9e\u9645\u7684\u7269\u7406\u5e93\u914d\u7f6e\u5730\u5740\uff0c\u53ef\u4ee5\u914d\u7f6e\u591a\u4e3b\u4e3b\u4ece\u7b49\u5176\u4ed6\u914d\u7f6e\uff0c\u591a\u4e2adataHost\u4ee3\u8868\u5206\u7247\u5bf9\u5e94\u7684\u7269\u7406\u5e93\u5730\u5740\uff0cwriteHost\u3001readHost\u4ee3\u8868\u8be5\u5206\u7247\u662f\u5426\u914d\u7f6e\u591a\u5199\uff0c\u4e3b\u4ece\uff0c\u8bfb\u5199\u5206\u79bb\u7b49\u9ad8\u7ea7\u7279\u6027\u3002\nrule.xml\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;!DOCTYPE mycat:rule SYSTEM &quot;rule.dtd&quot;&gt;\n&lt;mycat:rule xmlns:mycat=&quot;http://io.mycat/&quot;&gt;\n    &lt;tableRule name=&quot;rule1&quot;&gt;\n        &lt;rule&gt;\n            &lt;columns&gt;id&lt;/columns&gt;\n            &lt;algorithm&gt;func1&lt;/algorithm&gt;\n        &lt;/rule&gt;\n    &lt;/tableRule&gt;\n\n    &lt;tableRule name=&quot;rule2&quot;&gt;\n        &lt;rule&gt;\n            &lt;columns&gt;user_id&lt;/columns&gt;\n            &lt;algorithm&gt;func1&lt;/algorithm&gt;\n        &lt;/rule&gt;\n    &lt;/tableRule&gt;\n\n    &lt;tableRule name=&quot;sharding-by-intfile&quot;&gt;\n        &lt;rule&gt;\n            &lt;columns&gt;sharding_id&lt;/columns&gt;\n            &lt;algorithm&gt;hash-int&lt;/algorithm&gt;\n        &lt;/rule&gt;\n    &lt;/tableRule&gt;\n    &lt;tableRule name=&quot;auto-sharding-long&quot;&gt;\n        &lt;rule&gt;\n            &lt;columns&gt;id&lt;/columns&gt;\n            &lt;algorithm&gt;rang-long&lt;/algorithm&gt;\n        &lt;/rule&gt;\n    &lt;/tableRule&gt;\n    &lt;tableRule name=&quot;mod-long&quot;&gt;\n        &lt;rule&gt;\n            &lt;columns&gt;id&lt;/columns&gt;\n            &lt;algorithm&gt;mod-long&lt;/algorithm&gt;\n        &lt;/rule&gt;\n    &lt;/tableRule&gt;\n    &lt;tableRule name=&quot;sharding-by-murmur&quot;&gt;\n        &lt;rule&gt;\n            &lt;columns&gt;id&lt;/columns&gt;\n            &lt;algorithm&gt;murmur&lt;/algorithm&gt;\n        &lt;/rule&gt;\n    &lt;/tableRule&gt;\n    &lt;tableRule name=&quot;crc32slot&quot;&gt;\n        &lt;rule&gt;\n            &lt;columns&gt;id&lt;/columns&gt;\n            &lt;algorithm&gt;crc32slot&lt;/algorithm&gt;\n        &lt;/rule&gt;\n    &lt;/tableRule&gt;\n    &lt;tableRule name=&quot;sharding-by-month&quot;&gt;\n        &lt;rule&gt;\n            &lt;columns&gt;create_time&lt;/columns&gt;\n            &lt;algorithm&gt;partbymonth&lt;/algorithm&gt;\n        &lt;/rule&gt;\n    &lt;/tableRule&gt;\n    &lt;tableRule name=&quot;latest-month-calldate&quot;&gt;\n        &lt;rule&gt;\n            &lt;columns&gt;calldate&lt;/columns&gt;\n            &lt;algorithm&gt;latestMonth&lt;/algorithm&gt;\n        &lt;/rule&gt;\n    &lt;/tableRule&gt;\n\n    &lt;tableRule name=&quot;auto-sharding-rang-mod&quot;&gt;\n        &lt;rule&gt;\n            &lt;columns&gt;id&lt;/columns&gt;\n            &lt;algorithm&gt;rang-mod&lt;/algorithm&gt;\n        &lt;/rule&gt;\n    &lt;/tableRule&gt;\n\n    &lt;tableRule name=&quot;jch&quot;&gt;\n        &lt;rule&gt;\n            &lt;columns&gt;id&lt;/columns&gt;\n            &lt;algorithm&gt;jump-consistent-hash&lt;/algorithm&gt;\n        &lt;/rule&gt;\n    &lt;/tableRule&gt;\n\n    &lt;function name=&quot;murmur&quot;\n        class=&quot;io.mycat.route.function.PartitionByMurmurHash&quot;&gt;\n        &lt;property name=&quot;seed&quot;&gt;0&lt;/property&gt;&lt;!-- \u9ed8\u8ba4\u662f0 --&gt;\n        &lt;property name=&quot;count&quot;&gt;2&lt;/property&gt;&lt;!-- \u8981\u5206\u7247\u7684\u6570\u636e\u5e93\u8282\u70b9\u6570\u91cf\uff0c\u5fc5\u987b\u6307\u5b9a\uff0c\u5426\u5219\u6ca1\u6cd5\u5206\u7247 --&gt;\n        &lt;property name=&quot;virtualBucketTimes&quot;&gt;160&lt;/property&gt;&lt;!-- \u4e00\u4e2a\u5b9e\u9645\u7684\u6570\u636e\u5e93\u8282\u70b9\u88ab\u6620\u5c04\u4e3a\u8fd9\u4e48\u591a\u865a\u62df\u8282\u70b9\uff0c\u9ed8\u8ba4\u662f160\u500d\uff0c\u4e5f\u5c31\u662f\u865a\u62df\u8282\u70b9\u6570\u662f\u7269\u7406\u8282\u70b9\u6570\u7684160\u500d --&gt;\n        &lt;!-- &lt;property name=&quot;weightMapFile&quot;&gt;weightMapFile&lt;/property&gt; \u8282\u70b9\u7684\u6743\u91cd\uff0c\u6ca1\u6709\u6307\u5b9a\u6743\u91cd\u7684\u8282\u70b9\u9ed8\u8ba4\u662f1\u3002\u4ee5properties\u6587\u4ef6\u7684\u683c\u5f0f\u586b\u5199\uff0c\u4ee5\u4ece0\u5f00\u59cb\u5230count-1\u7684\u6574\u6570\u503c\u4e5f\u5c31\u662f\u8282\u70b9\u7d22\u5f15\u4e3akey\uff0c\u4ee5\u8282\u70b9\u6743\u91cd\u503c\u4e3a\u503c\u3002\u6240\u6709\u6743\u91cd\u503c\u5fc5\u987b\u662f\u6b63\u6574\u6570\uff0c\u5426\u5219\u4ee51\u4ee3\u66ff --&gt;\n        &lt;!-- &lt;property name=&quot;bucketMapPath&quot;&gt;/etc/mycat/bucketMapPath&lt;/property&gt; \n            \u7528\u4e8e\u6d4b\u8bd5\u65f6\u89c2\u5bdf\u5404\u7269\u7406\u8282\u70b9\u4e0e\u865a\u62df\u8282\u70b9\u7684\u5206\u5e03\u60c5\u51b5\uff0c\u5982\u679c\u6307\u5b9a\u4e86\u8fd9\u4e2a\u5c5e\u6027\uff0c\u4f1a\u628a\u865a\u62df\u8282\u70b9\u7684murmur hash\u503c\u4e0e\u7269\u7406\u8282\u70b9\u7684\u6620\u5c04\u6309\u884c\u8f93\u51fa\u5230\u8fd9\u4e2a\u6587\u4ef6\uff0c\u6ca1\u6709\u9ed8\u8ba4\u503c\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\uff0c\u5c31\u4e0d\u4f1a\u8f93\u51fa\u4efb\u4f55\u4e1c\u897f --&gt;\n    &lt;/function&gt;\n\n    &lt;function name=&quot;crc32slot&quot;\n              class=&quot;io.mycat.route.function.PartitionByCRC32PreSlot&quot;&gt;\n    &lt;/function&gt;\n    &lt;function name=&quot;hash-int&quot;\n        class=&quot;io.mycat.route.function.PartitionByFileMap&quot;&gt;\n        &lt;property name=&quot;mapFile&quot;&gt;partition-hash-int.txt&lt;/property&gt;\n    &lt;/function&gt;\n    &lt;function name=&quot;rang-long&quot;\n        class=&quot;io.mycat.route.function.AutoPartitionByLong&quot;&gt;\n        &lt;property name=&quot;mapFile&quot;&gt;autopartition-long.txt&lt;/property&gt;\n    &lt;/function&gt;\n    &lt;function name=&quot;mod-long&quot; class=&quot;io.mycat.route.function.PartitionByMod&quot;&gt;\n        &lt;!-- how many data nodes --&gt;\n        &lt;property name=&quot;count&quot;&gt;3&lt;/property&gt;\n    &lt;/function&gt;\n\n    &lt;function name=&quot;func1&quot; class=&quot;io.mycat.route.function.PartitionByLong&quot;&gt;\n        &lt;property name=&quot;partitionCount&quot;&gt;8&lt;/property&gt;\n        &lt;property name=&quot;partitionLength&quot;&gt;128&lt;/property&gt;\n    &lt;/function&gt;\n    &lt;function name=&quot;latestMonth&quot;\n        class=&quot;io.mycat.route.function.LatestMonthPartion&quot;&gt;\n        &lt;property name=&quot;splitOneDay&quot;&gt;24&lt;/property&gt;\n    &lt;/function&gt;\n    &lt;function name=&quot;partbymonth&quot;\n        class=&quot;io.mycat.route.function.PartitionByMonth&quot;&gt;\n        &lt;property name=&quot;dateFormat&quot;&gt;yyyy-MM-dd&lt;/property&gt;\n        &lt;property name=&quot;sBeginDate&quot;&gt;2015-01-01&lt;/property&gt;\n    &lt;/function&gt;\n\n    &lt;function name=&quot;rang-mod&quot; class=&quot;io.mycat.route.function.PartitionByRangeMod&quot;&gt;\n            &lt;property name=&quot;mapFile&quot;&gt;partition-range-mod.txt&lt;/property&gt;\n    &lt;/function&gt;\n\n    &lt;function name=&quot;jump-consistent-hash&quot; class=&quot;io.mycat.route.function.PartitionByJumpConsistentHash&quot;&gt;\n        &lt;property name=&quot;totalBuckets&quot;&gt;3&lt;/property&gt;\n    &lt;/function&gt;\n&lt;/mycat:rule&gt;\n\n\u914d\u7f6eMycat\n\u4fee\u6539\u914d\u7f6e\u6587\u4ef6server.xml\n\u4fee\u6539\u7528\u6237\u4fe1\u606f\uff0c\u4e0eMySQL\u533a\u5206\uff0c \u5982\u4e0b\uff1a\n2020-02-15_171149\n\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 schema.xml\n\u5220\u9664\u6807\u7b7e\u95f4\u7684\u8868\u4fe1\u606f\uff0c \u6807\u7b7e\u53ea\u7559\u4e00\u4e2a\uff0c \u6807\u7b7e\u53ea\u7559\u4e00\u4e2a\uff0c \n\u53ea\u7559\u4e00\u5bf9\n2020-02-15_172620\n\u6d4b\u8bd5\u662f\u5426\u80fd\u8fde\u63a5\n\u6d4b\u8bd5\u524d\uff0c\u5148\u5f00\u542fMysql\u7684\u8fdc\u7a0b\u8bbf\u95ee\u6743\u9650\u548c\u5173\u95ed\u9632\u706b\u5899\uff08\u6216\u8005\u653e\u884c3306\u7aef\u53e3\uff09\u3002\u7136\u540e\u6d4b\u8bd5\u672c\u673a\u662f\u5426\u80fd\u591f\u901a\u8fc7\u8fdc\u7a0b\u65b9\u5f0f\u8fde\u63a5\u672c\u673a\u3002\n\u4e3b\u673a1\uff1a192.168.2.2\nmysql -uroot -proot -h192.168.2.2 -P3306\n\n\u4e3b\u673a2\uff1a\nmysql -uroot -proot -h192.168.2.3 -P3306\n\n\u6d4b\u8bd5\u6210\u529f\u5728\u7ee7\u7eed\u4e0b\u4e00\u6b65\u3002\u767b\u5f55mycat\uff0c\u9ed8\u8ba4\u7aef\u53e3\u4e3a8066.\u53ef\u4ee5\u901a\u8fc7server.xml\u4e2d8066\u6765\u4fee\u6539\u7aef\u53e3\n\nmysql -umycat -proot -h 192.168.2.2 -P8066\n\u8fd9\u65f6\u5019\u53ef\u4ee5\u770b\u5230TESTDB\uff0c\u4f46\u662f\u5982\u8981\u64cd\u4f5cTESTDB\u3002\u9700\u8981\u5728\u4e3b\u673a1\uff1a192.168.2.2\u548c\u4e3b\u673a2\uff1a192.168.2.3\u4e2d\u521b\u5efatestdb\u3002schema.xml\u4e2d\u5c31\u662f\u8fd9\u4e48\u914d\u7f6e\u3002\u5982\u4e0a\u56fe\u3002\n\nmysql&gt; show @@version;\n+---------------------------------------------+\n| VERSION                                     |\n+---------------------------------------------+\n| 5.6.29-mycat-1.6.7.1-release-20190627191042 |\n+---------------------------------------------+\n1 row in set (0.00 sec)\n\u642d\u5efa\u8bfb\u5199\u5206\u79bb\n\u642d\u5efa\u4e00\u4e3b\u4e00\u4ece\n\u4e00\u4e2a\u4e3b\u673a\u7528\u4e8e\u5904\u7406\u6240\u6709\u5199\u8bf7\u6c42\uff0c\u4e00\u53f0\u4ece\u673a\u8d1f\u8d23\u6240\u6709\u8bfb\u8bf7\u6c42\uff0c\n\u67b6\u6784:\n2020-02-15_203717\n\u4e00\u4e3b\u4e00\u4ece\u642d\u5efa\u6bd4\u8f83\u5bb9\u6613\u3002\u4f46\u662f\u9700\u8981\u5148\u642d\u5efa\u4e3b\u673a\uff08192.168.2.2\uff09\u548c \u4ece\u673a\uff08192.168.2.3\uff09\u4e4b\u95f4\u7684\u4e3b\u4ece\u590d\u5236\u3002\n\u4e3b\u4ece\u590d\u5236\n\u539f\u7406\u56fe\uff1a\n2020-02-15_204254\n\nmaster\nbinlog dump\u7ebf\u7a0b\uff1a\u5f53\u4e3b\u5e93\u4e2d\u6709\u6570\u636e\u66f4\u65b0\u65f6\uff0c\u90a3\u4e48\u4e3b\u5e93\u5c31\u4f1a\u6839\u636e\u6309\u7167\u8bbe\u7f6e\u7684binlog\u683c\u5f0f\uff0c\u5c06\u6b64\u6b21\u66f4\u65b0\u7684\u4e8b\u4ef6\u7c7b\u578b\u5199\u5165\u5230\u4e3b\u5e93\u7684binlog\u6587\u4ef6\u4e2d\uff0c\u6b64\u65f6\u4e3b\u5e93\u4f1a\u521b\u5efalog dump\u7ebf\u7a0b\u901a\u77e5slave\u6709\u6570\u636e\u66f4\u65b0\uff0c\u5f53I/O\u7ebf\u7a0b\u8bf7\u6c42\u65e5\u5fd7\u5185\u5bb9\u65f6\uff0c\u4f1a\u5c06\u6b64\u65f6\u7684binlog\u540d\u79f0\u548c\u5f53\u524d\u66f4\u65b0\u7684\u4f4d\u7f6e\u540c\u65f6\u4f20\u7ed9slave\u7684I/O\u7ebf\u7a0b\u3002\n\n\nslave\nI/O\u7ebf\u7a0b\uff1a\u8be5\u7ebf\u7a0b\u4f1a\u8fde\u63a5\u5230master\uff0c\u5411log dump\u7ebf\u7a0b\u8bf7\u6c42\u4e00\u4efd\u6307\u5b9abinlog\u6587\u4ef6\u4f4d\u7f6e\u7684\u526f\u672c\uff0c\u5e76\u5c06\u8bf7\u6c42\u56de\u6765\u7684binlog\u5b58\u5230\u672c\u5730\u7684relay log\u4e2d\uff0crelay log\u548cbinlog\u65e5\u5fd7\u4e00\u6837\u4e5f\u662f\u8bb0\u5f55\u4e86\u6570\u636e\u66f4\u65b0\u7684\u4e8b\u4ef6\uff0c\u5b83\u4e5f\u662f\u6309\u7167\u9012\u589e\u540e\u7f00\u540d\u7684\u65b9\u5f0f\uff0c\u4ea7\u751f\u591a\u4e2arelay log\uff08 host_name-relay-bin.000001\uff09\u6587\u4ef6\uff0cslave\u4f1a\u4f7f\u7528\u4e00\u4e2aindex\u6587\u4ef6\uff08 host_name-relay-bin.index\uff09\u6765\u8ffd\u8e2a\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684relay log\u6587\u4ef6\u3002\nSQL\u7ebf\u7a0b\uff1a\u8be5\u7ebf\u7a0b\u68c0\u6d4b\u5230relay log\u6709\u66f4\u65b0\u540e\uff0c\u4f1a\u8bfb\u53d6\u5e76\u5728\u672c\u5730\u505aredo\u64cd\u4f5c\uff0c\u5c06\u53d1\u751f\u5728\u4e3b\u5e93\u7684\u4e8b\u4ef6\u5728\u672c\u5730\u91cd\u65b0\u6267\u884c\u4e00\u904d\uff0c\u6765\u4fdd\u8bc1\u4e3b\u4ece\u6570\u636e\u540c\u6b65\u3002\u6b64\u5916\uff0c\u5982\u679c\u4e00\u4e2arelay log\u6587\u4ef6\u4e2d\u7684\u5168\u90e8\u4e8b\u4ef6\u90fd\u6267\u884c\u5b8c\u6bd5\uff0c\u90a3\u4e48SQL\u7ebf\u7a0b\u4f1a\u81ea\u52a8\u5c06\u8be5relay log \u6587\u4ef6\u5220\u9664\u6389\u3002\n\n\n\nMySQL\u590d\u5236\u652f\u6301\u591a\u79cd\u4e0d\u540c\u7684\u590d\u5236\u7b56\u7565\uff0c\u5305\u62ec\u540c\u6b65\u3001\u534a\u540c\u6b65\u3001\u5f02\u6b65\u548c\u5ef6\u8fdf\u7b56\u7565\u7b49\u3002\n\n\u540c\u6b65\u7b56\u7565\uff1aMaster\u8981\u7b49\u5f85\u6240\u6709Slave\u5e94\u7b54\u4e4b\u540e\u624d\u4f1a\u63d0\u4ea4\uff08MySql\u5bf9DB\u64cd\u4f5c\u7684\u63d0\u4ea4\u901a\u5e38\u662f\u5148\u5bf9\u64cd\u4f5c\u4e8b\u4ef6\u8fdb\u884c\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u5199\u5165\u7136\u540e\u518d\u8fdb\u884c\u63d0\u4ea4\uff09\u3002\n\u534a\u540c\u6b65\u7b56\u7565\uff1aMaster\u7b49\u5f85\u81f3\u5c11\u4e00\u4e2aSlave\u5e94\u7b54\u5c31\u53ef\u4ee5\u63d0\u4ea4\u3002\n\u5f02\u6b65\u7b56\u7565\uff1aMaster\u4e0d\u9700\u8981\u7b49\u5f85Slave\u5e94\u7b54\u5c31\u53ef\u4ee5\u63d0\u4ea4\u3002\n\u5ef6\u8fdf\u7b56\u7565\uff1aSlave\u8981\u81f3\u5c11\u843d\u540eMaster\u6307\u5b9a\u7684\u65f6\u95f4\n\n\u6839\u636ebinlog\u65e5\u5fd7\u683c\u5f0f\u7684\u4e0d\u540c\uff0cMySQL\u590d\u5236\u540c\u65f6\u652f\u6301\u591a\u79cd\u4e0d\u540c\u7684\u590d\u5236\u6a21\u5f0f\uff1a\n\n\u57fa\u4e8e\u8bed\u53e5\u7684\u590d\u5236\uff0c\u5373Statement Based Replication\uff08SBR\uff09\uff1a\u8bb0\u5f55\u6bcf\u4e00\u6761\u66f4\u6539\u6570\u636e\u7684sql\n\n\n\u4f18\u70b9\uff1abinlog\u6587\u4ef6\u8f83\u5c0f\uff0c\u8282\u7ea6I/O\uff0c\u6027\u80fd\u8f83\u9ad8\u3002\n\u7f3a\u70b9\uff1a\u4e0d\u662f\u6240\u6709\u7684\u6570\u636e\u66f4\u6539\u90fd\u4f1a\u5199\u5165binlog\u6587\u4ef6\u4e2d\uff0c\u5c24\u5176\u662f\u4f7f\u7528MySQL\u4e2d\u7684\u4e00\u4e9b\u7279\u6b8a\u51fd\u6570\uff08\u5982LOAD_FILE()\u3001UUID()\u7b49\uff09\u548c\u4e00\u4e9b\u4e0d\u786e\u5b9a\u7684\u8bed\u53e5\u64cd\u4f5c\uff0c\u4ece\u800c\u5bfc\u81f4\u4e3b\u4ece\u6570\u636e\u65e0\u6cd5\u590d\u5236\u7684\u95ee\u9898\u3002\n\n\n\u57fa\u4e8e\u884c\u7684\u590d\u5236\uff0c\u5373Row Based Replication\uff08RBR\uff09\uff1a\u4e0d\u8bb0\u5f55sql\uff0c\u53ea\u8bb0\u5f55\u6bcf\u884c\u6570\u636e\u7684\u66f4\u6539\u7ec6\u8282\n\n\n\u4f18\u70b9\uff1a\u8be6\u7ec6\u7684\u8bb0\u5f55\u4e86\u6bcf\u4e00\u884c\u6570\u636e\u7684\u66f4\u6539\u7ec6\u8282\uff0c\u8fd9\u4e5f\u610f\u5473\u7740\u4e0d\u4f1a\u7531\u4e8e\u4f7f\u7528\u4e00\u4e9b\u7279\u6b8a\u51fd\u6570\u6216\u5176\u4ed6\u60c5\u51b5\u5bfc\u81f4\u4e0d\u80fd\u590d\u5236\u7684\u95ee\u9898\u3002\n\u7f3a\u70b9\uff1a\u7531\u4e8erow\u683c\u5f0f\u8bb0\u5f55\u4e86\u6bcf\u4e00\u884c\u6570\u636e\u7684\u66f4\u6539\u7ec6\u8282\uff0c\u4f1a\u4ea7\u751f\u5927\u91cf\u7684binlog\u65e5\u5fd7\u5185\u5bb9\uff0c\u6027\u80fd\u4e0d\u4f73\uff0c\u5e76\u4e14\u4f1a\u589e\u5927\u4e3b\u4ece\u540c\u6b65\u5ef6\u8fdf\u51fa\u73b0\u7684\u51e0\u7387\u3002\n\n\n\u6df7\u5408\u590d\u5236\uff08Mixed\uff09\n\u4e00\u822c\u7684\u8bed\u53e5\u4fee\u6539\u4f7f\u7528statment\u683c\u5f0f\u4fdd\u5b58binlog\uff0c\u5982\u4e00\u4e9b\u51fd\u6570\uff0cstatement\u65e0\u6cd5\u5b8c\u6210\u4e3b\u4ece\u590d\u5236\u7684\u64cd\u4f5c\uff0c\u5219\u91c7\u7528row\u683c\u5f0f\u4fdd\u5b58binlog\uff0cMySQL\u4f1a\u6839\u636e\u6267\u884c\u7684\u6bcf\u4e00\u6761\u5177\u4f53\u7684sql\u8bed\u53e5\u6765\u533a\u5206\u5bf9\u5f85\u8bb0\u5f55\u7684\u65e5\u5fd7\u5f62\u5f0f\uff0c\u4e5f\u5c31\u662f\u5728Statement\u548cRow\u4e4b\u95f4\u9009\u62e9\u4e00\u79cd\u3002\n\n\n\u4fee\u6539\u4e3b\u673a1\u7684mysql\u914d\u7f6e\u6587\u4ef6\uff1a\nvim /etc/my.cnf\n\nmy.cnf:   \u5728[mysqld]\u6807\u7b7e\u4e0b\n\n#\u4e3b\u670d\u52a1\u5668\u552f\u4e00ID\nserver-id=1\n#\u542f\u7528\u4e8c\u8fdb\u5236\u65e5\u5fd7\nlog-bin=mysql-bin\n## \u8bbe\u7f6e\u4e0d\u8981\u590d\u5236\u7684\u6570\u636e\u5e93(\u53ef\u8bbe\u7f6e\u591a\u4e2a)\nbinlog-ignore-db=mysql\nbinlog-ignore-db=information_schema\n##\u8bbe\u7f6e\u9700\u8981\u590d\u5236\u7684\u6570\u636e\u5e93\nbinlog-do-db=testdb\n##\u8bbe\u7f6elogbin\u683c\u5f0f\nbinlog_format=STATEMENT\n\u91cd\u542fMysql\u6570\u636e\u5e93 \u5e76\u91cd\u65b0\u767b\u5f55\uff1a\n\ncreate user slave IDENTIFIED BY 'root';\nGRANT REPLICATION SLAVE ON *.* TO 'slave'@'%' IDENTIFIED BY 'root';\nflush privileges;\n\u82e5\u63d0\u793a\u5bc6\u7801\u4e0d\u7b26\u5408\u8981\u6c42\uff0c\u8fd9\u4fee\u6539Mysql\u7684\u7b56\u7565\uff1a\nset global validate_password_policy=LOW; \nset global validate_password_length=4; \nflush privileges;\n\n\u4fee\u6539\u4ece\u673a\u7684\u914d\u7f6e\uff1a\n\nvim /eyc/my.cnf\n\u914d\u7f6e\u5982\u4e0b\uff08\u672c\u6b21\u7684\u4ece\u673a\u7684\u7cfb\u7edf\u4e3acentos8\uff09\uff1a\n\n[mysqld]\nserver-id=2\nrelay-log=mysql-relay\n\u5982\u56fe\uff1a\n2020-02-16_155404\n\u67e5\u8be2\u4e3b\u673amaster\u7684\u72b6\u6001\uff1a\nmysql&gt; show master status;\n+------------------+----------+--------------+--------------------------+-------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB         | Executed_Gtid_Set |\n+------------------+----------+--------------+--------------------------+-------------------+\n| mysql-bin.000002 |      154 | testdb       | mysql,information_schema |                   |\n+------------------+----------+--------------+--------------------------+-------------------+\n1 row in set (0.00 sec)\n\n---\u300b \u8bb0\u5f55\u4e0bFile\u548cPosition\u7684\u503c\uff0c\u6267\u884c\u5b8c\u6b64\u6b65\u9aa4\u540e\u4e0d\u8981\u518d\u64cd\u4f5c\u4e3b\u670d\u52a1\u5668MySQL\uff0c\u9632\u6b62\u4e3b\u670d\u52a1\u5668\u72b6\u6001\u503c\u53d8\u5316\n\u5728\u4ece\u673a\u4e0a\u914d\u7f6e\u9700\u8981\u590d\u5236\u7684\u4e3b\u673a \uff1a\n\u683c\u5f0f\uff1a\n\nCHANGE MASTER TO MASTER_HOST='\u4e3b\u673a\u7684IP\u5730\u5740',\nMASTER_USER='slave',\nMASTER_PASSWORD='123123',\nMASTER_LOG_FILE='mysql-bin.\u5177\u4f53\u6570\u5b57',MASTER_LOG_POS=\u5177\u4f53\u503c;\n\u672c\u6b21\u914d\u7f6e\u4e3a\uff1a(\u5728\u4ece\u673a\u4e0a\u8fd0\u884c,\u4e0b\u9762\u53c2\u6570\u6839\u636e\u5177\u4f53\u60c5\u51b5\u4fee\u6539)\n\nCHANGE MASTER TO MASTER_HOST='192.168.2.2',\nMASTER_USER='slave',\nMASTER_PASSWORD='root',\nMASTER_LOG_FILE='mysql-bin.000002',MASTER_LOG_POS=154;\n\u542f\u52a8\u4ece\u670d\u52a1\u5668\u590d\u5236\u529f\u80fd\nstart slave;\n\u67e5\u770b\u4ece\u670d\u52a1\u5668\u72b6\u6001\nshow slave status\\G;\n\u65e0\u62a5\u9519\u8fd9\u6210\u529f\uff0c\u5982\u4e0b\u56fe\uff1a\n2020-02-16_105728\n\u8865\u5145\u51e0\u4e2a\u547d\u4ee4\uff1a\nstop slave;  #\u505c\u6b62slave\nreset master;   #\u91cd\u7f6emaster\n\u56e0\u4e3a\u914d\u7f6e\u4e2d\u4f7f\u7528testdb\uff0c\u6240\u4ee5\u8981\u5728\u4e3b\u673a\u4e00\uff08192.168.2.2\uff09\u548c\u4e3b\u673a\u4e8c\uff08192.168.2.3\uff09\u521b\u5efa\u6570\u636e\u5e93testdb\ncreate database testdb;\n\ncreate table my(\nid varchar(10),\nhostname varchar(120)\n);\ninsert into my values (1,@@hostname);  ##\u7531\u4e8e\u672c\u6b21\u5b9e\u9a8c@@hostname\u5728\u4e24\u4e2a\u4e3b\u673a\u7684\u5185\u5bb9\uff0c\u4e3a\u4e86\u533a\u5206\uff0c\u76f4\u63a5\u4f7f\u7528\u5de5\u5177\u5206\u522b\u4fee\u6539\u8fd9\u4e2a\u8868\u7684\u503c\u4e3acentos7\u548ccentos8\n\nmysql&gt; select * from my;\n+------+----------+\n| id   | hostname |\n+------+----------+\n| 1    | centos7  |\n+------+----------+\n#\u591a\u6b21\u6267\u884c\u67e5\u8be2\u8bed\u53e5\uff0c\u90fd\u662f\u8f93\u51facentos7\uff0c\u8bfb\u8bf7\u6c42\u90fd\u53d1\u9001\u5230\u5199\u4e3b\u673a\u4e0a\u3002\u672a\u5f00\u542f\u8bfb\u5199\u5206\u79bb\u3002\n\n2020-02-16_160426\n\u5f00\u542f\u8bfb\u5199\u5206\u79bb\n\u4fee\u6539schema.xml \u7684\u7684balance\u5c5e\u6027\uff0c\u901a\u8fc7\u6b64\u5c5e\u6027\u914d\u7f6e\u8bfb\u5199\u5206\u79bb\u7684\u7c7b\u578b\n\u8d1f\u8f7d\u5747\u8861\u7c7b\u578b\uff0c\u76ee\u524d\u7684\u53d6\u503c\u67094 \u79cd\uff1a\n\uff081\uff09 balance=\"0\", \u4e0d\u5f00\u542f\u8bfb\u5199\u5206\u79bb\u673a\u5236\uff0c \u6240\u6709\u8bfb\u64cd\u4f5c\u90fd\u53d1\u9001\u5230\u5f53\u524d\u53ef\u7528\u7684 writeHost \u4e0a\u3002\n\uff082\uff09 balance=\"1\"\uff0c\u5168\u90e8\u7684 readHost \u4e0e stand by writeHost \u53c2\u4e0e select \u8bed\u53e5\u7684\u8d1f\u8f7d\u5747\u8861\uff0c\u7b80\u5355\u7684\u8bf4\uff0c\u5f53\u53cc\u4e3b\u53cc\u4ece\n\u6a21\u5f0f(M1-&gt;S1\uff0c M2-&gt;S2\uff0c\u5e76\u4e14 M1 \u4e0e M2 \u4e92\u4e3a\u4e3b\u5907)\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c M2,S1,S2 \u90fd\u53c2\u4e0e select \u8bed\u53e5\u7684\u8d1f\u8f7d\u5747\u8861\u3002\n\uff083\uff09 balance=\"2\"\uff0c\u6240\u6709\u8bfb\u64cd\u4f5c\u90fd\u968f\u673a\u7684\u5728 writeHost\u3001 readhost \u4e0a\u5206\u53d1\u3002\n\uff084\uff09 balance=\"3\"\uff0c\u6240\u6709\u8bfb\u8bf7\u6c42\u968f\u673a\u7684\u5206\u53d1\u5230 readhost \u6267\u884c\uff0c writerHost \u4e0d\u8d1f\u62c5\u8bfb\u538b\u529b\n\u4fee\u6539balance\u503c\u4e3a1\uff0c\u5f00\u542f\u8bfb\u5199\u5206\u79bb\u3002\u4f46\u662f\u7531\u4e8e\u53ea\u6709\u4e00\u4e2a\u4e3b\u673a\u548c\u4ece\u673a\u3002\u8fd9\u4e2a\u7ed3\u679c\u4f1a\u548cbalance=3\u7684\u7ed3\u679c\u4e00\u6837\uff0c\u6240\u4ee5\u672c\u6b21\u4fee\u6539\u4e3a2\uff0c\u8fd9\u6837\u53ef\u4ee5\u770b\u5230\u4e0d\u4e00\u6837\u7684\u7ed3\u679c\u3002\u4fee\u6539\u5b8c\u6210\u540e\u91cd\u542fMycat\u3002\n\u6548\u679c\u5982\u4e0b\uff1a\n2020-02-16_161327\n\u642d\u5efa\u53cc\u4e3b\u53cc\u4ece\n\u7ed3\u679c\u56fe\uff1a\n2020-02-16_161600\n\u53cc\u4e3b\u53cc\u4ece\uff1a\n\u4e3b1\uff1a192.168.2.2\n\u4ece1\uff1a192.168.2.3\n\u4e3b2\uff1a192.168.2.5\n\u4ece2\uff1a192.168.2.6\n\u914d\u7f6e\u5982\u4e0b\n\u4fee\u6539\u914d\u7f6e\uff1a\n\nvim /etc/my.cnf   #\u4e0b\u9762\u56db\u53f0\u673a\u5668\u90fd\u662f\u4fee\u6539\u8fd9\u4e2a\u7ed9\u6587\u4ef6\n\u4e3b\uff08master\uff091:\n\n#\u4e3b\u670d\u52a1\u5668\u552f\u4e00ID\nserver-id=1\n#\u542f\u7528\u4e8c\u8fdb\u5236\u65e5\u5fd7\nlog-bin=mysql-bin\n# \u8bbe\u7f6e\u4e0d\u8981\u590d\u5236\u7684\u6570\u636e\u5e93(\u53ef\u8bbe\u7f6e\u591a\u4e2a)\nbinlog-ignore-db=mysql\nbinlog-ignore-db=information_schema\n#\u8bbe\u7f6e\u9700\u8981\u590d\u5236\u7684\u6570\u636e\u5e93\nbinlog-do-db=testdb   #\u9700\u8981\u590d\u5236\u7684\u4e3b\u6570\u636e\u5e93\u540d\u5b57\n#\u8bbe\u7f6elogbin\u683c\u5f0f\nbinlog_format=STATEMENT\n# \u5728\u4f5c\u4e3a\u4ece\u6570\u636e\u5e93\u7684\u65f6\u5019\uff0c \u6709\u5199\u5165\u64cd\u4f5c\u4e5f\u8981\u66f4\u65b0\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\nlog-slave-updates\n#\u8868\u793a\u81ea\u589e\u957f\u5b57\u6bb5\u6bcf\u6b21\u9012\u589e\u7684\u91cf\uff0c\u6307\u81ea\u589e\u5b57\u6bb5\u7684\u8d77\u59cb\u503c\uff0c\u5176\u9ed8\u8ba4\u503c\u662f1\uff0c \u53d6\u503c\u8303\u56f4\u662f1 .. 65535\nauto-increment-increment=2\n# \u8868\u793a\u81ea\u589e\u957f\u5b57\u6bb5\u4ece\u54ea\u4e2a\u6570\u5f00\u59cb\uff0c\u6307\u5b57\u6bb5\u4e00\u6b21\u9012\u589e\u591a\u5c11\uff0c\u4ed6\u7684\u53d6\u503c\u8303\u56f4\u662f1 .. 65535\nauto-increment-offset=1\n\u4e3b\u673a\uff08master\uff09\u4e8c\uff1a\n\n#\u4e3b\u670d\u52a1\u5668\u552f\u4e00ID\nserver-id=3\n#\u542f\u7528\u4e8c\u8fdb\u5236\u65e5\u5fd7\nlog-bin=mysql-bin\n# \u8bbe\u7f6e\u4e0d\u8981\u590d\u5236\u7684\u6570\u636e\u5e93(\u53ef\u8bbe\u7f6e\u591a\u4e2a)\nbinlog-ignore-db=mysql\nbinlog-ignore-db=information_schema\n#\u8bbe\u7f6e\u9700\u8981\u590d\u5236\u7684\u6570\u636e\u5e93\nbinlog-do-db=testdb   #\u9700\u8981\u590d\u5236\u7684\u4e3b\u6570\u636e\u5e93\u540d\u5b57\n#\u8bbe\u7f6elogbin\u683c\u5f0f\nbinlog_format=STATEMENT\n# \u5728\u4f5c\u4e3a\u4ece\u6570\u636e\u5e93\u7684\u65f6\u5019\uff0c\u6709\u5199\u5165\u64cd\u4f5c\u4e5f\u8981\u66f4\u65b0\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\nlog-slave-updates\n#\u8868\u793a\u81ea\u589e\u957f\u5b57\u6bb5\u6bcf\u6b21\u9012\u589e\u7684\u91cf\uff0c\u6307\u81ea\u589e\u5b57\u6bb5\u7684\u8d77\u59cb\u503c\uff0c\u5176\u9ed8\u8ba4\u503c\u662f1\uff0c\u53d6\u503c\u8303\u56f4\u662f1 .. 65535\nauto-increment-increment=2\n# \u8868\u793a\u81ea\u589e\u957f\u5b57\u6bb5\u4ece\u54ea\u4e2a\u6570\u5f00\u59cb\uff0c\u6307\u5b57\u6bb5\u4e00\u6b21\u9012\u589e\u591a\u5c11\uff0c\u4ed6\u7684\u53d6\u503c\u8303\u56f4\u662f1 .. 65535\nauto-increment-offset=2\n\u4ece\u673a\uff08slave\uff09\u4e00\uff1a\n\n#\u4ece\u670d\u52a1\u5668\u552f\u4e00ID\nserver-id=2\n#\u542f\u7528\u4e2d\u7ee7\u65e5\u5fd7\nrelay-log=mysql-relay\n\u4ece\u673a\u4e8c\uff08slave\uff09\uff1a\n\n#\u4ece\u670d\u52a1\u5668\u552f\u4e00ID\nserver-id=4\n#\u542f\u7528\u4e2d\u7ee7\u65e5\u5fd7\nrelay-log=mysql-relay\n\u6570\u636e\u5e93\u5728\u4fee\u6539\u5b8c\u6210\u540e\uff0c\u91cd\u542f\u4e00\u4e0b,\u5e76\u5173\u95ed\u9632\u706b\u5899\u6216\u8005\u653e\u5fc3\u76f8\u5173\u7aef\u53e3\uff0c\u59823306\n\u5728\u4e24\u53f0\u4e3b\u673a\uff0c\u5206\u522b\u5efa\u7acbslave\u8d26\u6237\u5e76\u6388\u6743\uff1a\n\ncreate user slave IDENTIFIED BY 'root';\nGRANT REPLICATION SLAVE ON *.* TO 'slave'@'%' IDENTIFIED BY 'root';\nflush privileges;GRANT REPLICATION SLAVE ON *.* TO 'slave'@'%' IDENTIFIED BY '123123';\n\u67e5\u8be2\u4e3b\u673a\uff08maste\uff09\u4e00\uff1a\n\nshow master status;\n\u67e5\u8be2\u4e3b\u673a\uff08master\uff09\u4e8c\uff1a\n\nshow master status;\n\u5206\u522b\u8bb0\u5f55\u4e0bFile\u548cPosition\u7684\u503c\uff0c\u6267\u884c\u5b8c\u6b64\u6b65\u9aa4\u540e\u4e0d\u8981\u518d\u64cd\u4f5c\u4e3b\u670d\u52a1\u5668MYSQL\uff0c\u9632\u6b62\u4e3b\u670d\u52a1\u5668\u72b6\u6001\u503c\u53d8\u5316\n\u56e0\u4e3a Slava1 \u590d\u5236 Master1\uff0c Slava2 \u590d\u5236 Master2 \uff0c\n\u6570\u636e\u683c\u5f0f\uff1a\n\nCHANGE MASTER TO MASTER_HOST='\u4e3b\u673a\u7684IP\u5730\u5740',\nMASTER_USER='slave',\nMASTER_PASSWORD='123123',\nMASTER_LOG_FILE='mysql-bin.\u5177\u4f53\u6570\u5b57',MASTER_LOG_POS=\u5177\u4f53\u503c;\n\u6240\u4ee5\u5728slave\u4e00\uff08192.168.2.3\uff09\u4e2d\u6267\u884c\uff1a\nCHANGE MASTER TO MASTER_HOST=&#39;192.168.2.2&#39;,\nMASTER_USER=&#39;slave&#39;,\nMASTER_PASSWORD=&#39;root&#39;,\nMASTER_LOG_FILE=&#39;mysql-bin.000002&#39;,MASTER_LOG_POS=154;     #\u6570\u5b57\u8981\u6839\u636e\u4e4b\u524d\u8bb0\u5f55\u7684\u6765\u586b\u5199\n\n\n\u542f\u52a8\u4e24\u53f0\u4ece\u670d\u52a1\u5668\u590d\u5236\u529f\u80fd\nstart slave; \n\n\u67e5\u770b\u4ece\u670d\u52a1\u5668\u72b6\u6001\uff0c\u6210\u529f\u5373\u53ef\nshow slave status\\G;\nslave\u4e8c\uff08192.168.2.6\uff09\u4e2d\u6267\u884c\nCHANGE MASTER TO MASTER_HOST=&#39;192.168.2.2&#39;,\nMASTER_USER=&#39;slave&#39;,\nMASTER_PASSWORD=&#39;root&#39;,\nMASTER_LOG_FILE=&#39;mysql-bin.000002&#39;,MASTER_LOG_POS=154;     #\u6570\u5b57\u8981\u6839\u636e\u4e4b\u524d\u8bb0\u5f55\u7684\u6765\u586b\u5199\n\n\n\u542f\u52a8\u4e24\u53f0\u4ece\u670d\u52a1\u5668\u590d\u5236\u529f\u80fd\nstart slave; \n\n\u67e5\u770b\u4ece\u670d\u52a1\u5668\u72b6\u6001\nshow slave status\\G;\n\u4e0a\u9762\u6b65\u9aa4\u548c\u4e00\u4e3b\u4e00\u4ece\u914d\u7f6e\u8fc7\u7a0b\u4e00\u6837\u3002\u8fd8\u6709\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u662f\u8981\u5b9e\u73b0master1\uff08192.168.2.2\uff09\u548cmaster2\uff08192.168.2.5\uff09\u4e4b\u95f4\u76f8\u4e92\u590d\u5236\uff0c\u5373\u662fMaster2 \u590d\u5236 Master1\uff0c Master1 \u590d\u5236 Master2\n\u5728\u4e3b\u673a\u4e00\uff08192.168.2.2\uff09\u4e2d\u6267\u884c\uff1a\nCHANGE MASTER TO MASTER_HOST=&#39;192.168.2.5&#39;,\nMASTER_USER=&#39;slave&#39;,\nMASTER_PASSWORD=&#39;root&#39;,\nMASTER_LOG_FILE=&#39;mysql-bin.000002&#39;,MASTER_LOG_POS=154;     #\u6570\u5b57\u8981\u6839\u636e\u4e4b\u524d\u8bb0\u5f55\u7684\u6765\u586b\u5199\n\n\u542f\u52a8\u4e24\u53f0\u4ece\u670d\u52a1\u5668\u590d\u5236\u529f\u80fd\nstart slave; \n\n\u67e5\u770b\u4ece\u670d\u52a1\u5668\u72b6\u6001\nshow slave status\\G;\n\n\u5728\u4e3b\u673a\u4e8c\uff08192.168.2.5\uff09\u4e2d\u6267\u884c\nCHANGE MASTER TO MASTER_HOST=&#39;192.168.2.2&#39;,\nMASTER_USER=&#39;slave&#39;,\nMASTER_PASSWORD=&#39;root&#39;,\nMASTER_LOG_FILE=&#39;mysql-bin.000002&#39;,MASTER_LOG_POS=154;     #\u6570\u5b57\u8981\u6839\u636e\u4e4b\u524d\u8bb0\u5f55\u7684\u6765\u586b\u5199\n\n\u542f\u52a8\u4e24\u53f0\u4ece\u670d\u52a1\u5668\u590d\u5236\u529f\u80fd\nstart slave; \n\n\u67e5\u770b\u4ece\u670d\u52a1\u5668\u72b6\u6001\nshow slave status\\G;\n\n\u4e0b\u9762\u4e24\u4e2a\u53c2\u6570\u90fd\u662fYes\uff0c\u5219\u8bf4\u660e\u4e3b\u4ece\u914d\u7f6e\u6210\u529f\uff01\nSlave_IO_Running: Yes\nSlave_SQL_Running: Yes\n\n\u4fee\u6539 Mycat \u7684\u914d\u7f6e\u6587\u4ef6 schema.xml\n\n\u4e00\uff1a\u4e3a\u4e86\u53cc\u4e3b\u53cc\u4ece\u8bfb\u5199\u5206\u79bbbalance\u8bbe\u7f6e\u4e3a1\n\n\u4e8c\uff1a\n.....\n&lt;dataNode name=\"dn1\" dataHost=\"host1\" database=\"testdb\" /&gt;\n&lt;dataHost name=\"host1\" maxCon=\"1000\" minCon=\"10\" balance=\"1\"  writeType=\"0\" dbType=\"mysql\" dbDriver=\"native\" switchType=\"1\"  slaveThreshold=\"100\" &gt;\n    &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;\n    &lt;!-- can have multi write hosts --&gt;\n    &lt;writeHost host=\"hostM1\" url=\"192.168.2.2:3306\" user=\"root\"  password=\"root\"&gt;\n          &lt;!-- can have multi read hosts --&gt;\n          &lt;readHost host=\"hostS1\" url=\"192.168.2.3:3306\" user=\"root\" password=\"root\" /&gt;\n    &lt;/writeHost&gt;\n\n    &lt;writeHost host=\"hostM2\" url=\"192.168.140.2:5\" user=\"root\"  password=\"root\"&gt;\n        &lt;!-- can have multi read hosts --&gt;\n        &lt;readHost host=\"hostS2\" url=\"192.168.2.6:3306\" user=\"root\"  password=\"root\" /&gt;\n    &lt;/writeHost&gt;\n&lt;/dataHost&gt;\n.....\n\u4e0a\u9762\u914d\u7f6e\u8981\u6839\u636e\u5177\u4f53\u60c5\u51b5\u914d\u7f6e\u3002\u4f8b\u5982host\uff0c url\uff0cuser,password,balance,writeType.\nbalance=\"1\": \u5168\u90e8\u7684readHost\u4e0estand by writeHost\u53c2\u4e0eselect\u8bed\u53e5\u7684\u8d1f\u8f7d\u5747\u8861\u3002\nwriteType=\"0\": \u6240\u6709\u5199\u64cd\u4f5c\u53d1\u9001\u5230\u914d\u7f6e\u7684\u7b2c\u4e00\u4e2awriteHost\uff0c\u7b2c\u4e00\u4e2a\u6302\u4e86\u5207\u5230\u8fd8\u751f\u5b58\u7684\u7b2c\u4e8c\u4e2a\nwriteType=\"1\"\uff0c\u6240\u6709\u5199\u64cd\u4f5c\u90fd\u968f\u673a\u7684\u53d1\u9001\u5230\u914d\u7f6e\u7684 writeHost\uff0c 1.5 \u4ee5\u540e\u5e9f\u5f03\u4e0d\u63a8\u8350\nwriteHost\uff0c\u91cd\u65b0\u542f\u52a8\u540e\u4ee5\u5207\u6362\u540e\u7684\u4e3a\u51c6\uff0c\u5207\u6362\u8bb0\u5f55\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d:dnindex.properties \u3002\nswitchType=\"1\":\n\n\u200b         1 \u9ed8\u8ba4\u503c\uff0c\u81ea\u52a8\u5207\u6362\u3002\n\u200b -1 \u8868\u793a\u4e0d\u81ea\u52a8\u5207\u6362\n\u200b 2 \u57fa\u4e8e MySQL \u4e3b\u4ece\u540c\u6b65\u7684\u72b6\u6001\u51b3\u5b9a\u662f\u5426\u5207\u6362\u3002\n\n\u6b64\u65f6\u5df2\u7ecf\u914d\u7f6e\u5b8c\u6210\u3002\u53ef\u4ee5\u542f\u52a8Mycat\u5f00\u59cb\u6d4b\u8bd5\u3002\u6d4b\u8bd5\u548c\u4e00\u4e3b\u4e00\u4ece\u6837\u3002\n\u5782\u76f4\u62c6\u5206\u2014\u2014\u5206\u5e93\n\u4e00\u4e2a\u6570\u636e\u5e93\u7531\u5f88\u591a\u8868\u7684\u6784\u6210\uff0c\u6bcf\u4e2a\u8868\u5bf9\u5e94\u7740\u4e0d\u540c\u7684\u4e1a\u52a1\uff0c\u5782\u76f4\u5207\u5206\u662f\u6307\u6309\u7167\u4e1a\u52a1\u5c06\u8868\u8fdb\u884c\u5206\u7c7b\uff0c\n\u5206\u5e03\u5230\u4e0d\u540c \u7684\u6570\u636e\u5e93\u4e0a\u9762\uff0c\u8fd9\u6837\u4e5f\u5c31\u5c06\u6570\u636e\u6216\u8005\u8bf4\u538b\u529b\u5206\u62c5\u5230\u4e0d\u540c\u7684\u5e93\u4e0a\u9762\u3002\n\u5982\u4f55\u5212\u5206\u8868\n\u5206\u5e93\u7684\u539f\u5219\uff1a \u6709\u7d27\u5bc6\u5173\u8054\u5173\u7cfb\u7684\u8868\u5e94\u8be5\u5728\u4e00\u4e2a\u5e93\u91cc\uff0c\u76f8\u4e92\u6ca1\u6709\u5173\u8054\u5173\u7cfb\u7684\u8868\u53ef\u4ee5\u5206\u5230\u4e0d\u540c\u7684\u5e93\u91cc\u3002\n\u4e00\u4e2a\u95ee\u9898\uff1a\u5728\u4e24\u53f0\u4e3b\u673a\u4e0a\u7684\u4e24\u4e2a\u6570\u636e\u5e93\u4e2d\u7684\u8868\uff0c\u80fd\u5426\u5173\u8054\u67e5\u8be2\uff1f\n\u7b54\u6848\uff1a\u4e0d\u53ef\u4ee5\u5173\u8054\u67e5\u8be2\n\u4f8b\u5982\uff1a\n\n\u8ba2\u5355\u72b6\u6001\u5b57\u5178\u8868 \n\u8ba2\u5355\u8be6\u7ec6\u8868 \n\u8ba2\u5355\u8868 \n\u5ba2\u6237\u8868 \n\n\u524d\u4e09\u5f20\u8868\u7531\u4e8e\u8981\u8fdb\u884c\u5173\u8054\u67e5\u8be2\uff0c\u5173\u7cfb\u7d27\u5bc6\u3002\u6240\u4ee5\u5ba2\u6237\u8868\u5206\u5728\u4e00\u4e2a\u6570\u636e\u5e93\uff0c\u53e6\u5916\u4e09\u5f20\u90fd\u9700\u8981\u5173\u8054\u67e5\u8be2\uff0c\u5206\u5728\u53e6\u5916\u4e00\u4e2a\u6570\u636e\u5e93\u3002\n\u4fee\u6539schema.xml\n....\n&lt;schema name=&quot;TESTDB&quot; checkSQLschema=&quot;false&quot; sqlMaxLimit=&quot;100&quot; dataNode=&quot;dn1&quot;&gt;\n       &lt;table name=&quot;customer&quot; dataNode=&quot;dn2&quot; &gt;&lt;/table&gt;\n&lt;/schema&gt;\n&lt;dataNode name=&quot;dn1&quot; dataHost=&quot;host1&quot; database=&quot;orders&quot; /&gt;   #orders\u662f\u6570\u636e\u5e93\n&lt;dataNode name=&quot;dn2&quot; dataHost=&quot;host2&quot; database=&quot;orders&quot; /&gt;\n\n\n&lt;dataHost name=&quot;host1&quot; maxCon=&quot;1000&quot; minCon=&quot;10&quot; balance=&quot;0&quot;  writeType=&quot;0&quot; dbType=&quot;mysql&quot;\ndbDriver=&quot;native&quot; switchType=&quot;1&quot;  slaveThreshold=&quot;100&quot;&gt;\n     &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;\n     &lt;!-- can have multi write hosts --&gt;\n     &lt;writeHost host=&quot;hostM1&quot; url=&quot;192.168.2.2:3306&quot; user=&quot;root&quot;  password=&quot;root&quot;&gt;\n     &lt;/writeHost&gt;\n&lt;/dataHost&gt;\n\n&lt;dataHost name=&quot;host2&quot; maxCon=&quot;1000&quot; minCon=&quot;10&quot; balance=&quot;0&quot;  writeType=&quot;0&quot; dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; switchType=&quot;1&quot;   slaveThreshold=&quot;100&quot;&gt;\n      &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;\n      &lt;!-- can have multi write hosts --&gt;\n      &lt;writeHost host=&quot;hostM2&quot; url=&quot;192.168.2.3:3306&quot; user=&quot;root&quot;  password=&quot;root&quot;&gt;\n      &lt;/writeHost&gt;\n&lt;/dataHost&gt;\n...\n\n\u56db\u5f20\u8868\u539f\u672c\u662f\u5728orders\u6570\u636e\u5e93\u4e2d\uff0c\u4e3a\u4e86\u51cf\u5c11\u6570\u636e\u5e93\u538b\u529b\u3002\u4e14\u5ba2\u6237\u8868\u548c\u5176\u4ed6\u4e09\u4e2a\u8868\u6ca1\u6709\u5bc6\u5207\u5173\u7cfb\u3002\u6240\u4ee5\u4e3b\u673a\u4e00\uff08192.168.2.2\uff09\u4e2d\u7684\u6570\u636e\u5e93orders\u4e2d\u5b58\u50a8\u524d\u4e09\u5f20\u8868\uff0c\u4e3b\u673a\u4e8c\uff08192.168.2.3\uff09\u4e2d\u7684\u6570\u636e\u5e93orders\u5b58\u50a8\u5ba2\u6237\u8868\u3002\n\u8fd8\u6709\uff1a\n\u5206\u5e93\u64cd\u4f5c\u4e0d\u662f\u5728\u539f\u6765\u7684\u8001\u6570\u636e\u5e93\u4e0a\u8fdb\u884c\u64cd\u4f5c\uff0c\u9700\u8981\u51c6\u5907\u4e24\u53f0\u673a\u5668\u5206\u522b\u5b89\u88c5\u65b0\u7684\u6570\u636e\u5e93 \uff0c\u5373\u662f\u9700\u8981\u5728\u4e24\u53f0\u673a\u5668\u4e0a\u624b\u52a8\u521b\u5efa\u6570\u636e\u5e93\u3002\n\ncreate database orders;\n\u542f\u52a8Mycat\uff0c\u5e76\u4e14\u767b\u5f55\n\ncd /usr/local/mycat/bin    #\u5207\u6362\u5230\u81ea\u5df1\u5b89\u88c5mycat\u7684\u76ee\u5f55\u4e0b\n./mycat start\n#\u767b\u5f55mycat\nmysql -umycat -proot -h192.168.2.2 -P8066\n\n#\u521b\u5efa\u56db\u4e2a\u8868\nCREATE TABLE customer(\nid INT AUTO_INCREMENT,\nNAME VARCHAR(200),\nPRIMARY KEY(id)\n);\n#\u8ba2\u5355\u8868 rows:600\u4e07\nCREATE TABLE orders(\nid INT AUTO_INCREMENT,\norder_type INT,\ncustomer_id INT,\namount DECIMAL(10,2),\nPRIMARY KEY(id)\n);\n#\u8ba2\u5355\u8be6\u7ec6\u8868 rows:600\u4e07\nCREATE TABLE orders_detail(\nid INT AUTO_INCREMENT,\ndetail VARCHAR(2000),\norder_id INT,\nPRIMARY KEY(id)\n);\n#\u8ba2\u5355\u72b6\u6001\u5b57\u5178\u8868 rows:20\nCREATE TABLE dict_order_type(\nid INT AUTO_INCREMENT,\norder_type VARCHAR(200),\nPRIMARY KEY(id)\n);\n\u521b\u5efa\u8868\u540e\uff0c\u6b63\u5e38\u7ed3\u679c\u662f\u4e00\u4e2a\u6570\u636e\u5e93\u6709\u4e09\u4e2a\u8868\uff0c\u53e6\u5916\u4e00\u4e2a\u6570\u636e\u5e93\u6709\u4e00\u4e2a\u987e\u5ba2\u8868\u3002\n\u6c34\u5e73\u62c6\u5206\u2014\u2014\u5206\u8868\n\u76f8\u5bf9\u4e8e\u5782\u76f4\u62c6\u5206\uff0c\u6c34\u5e73\u62c6\u5206\u4e0d\u662f\u5c06\u8868\u505a\u5206\u7c7b\uff0c\u800c\u662f\u6309\u7167\u67d0\u4e2a\u5b57\u6bb5\u7684\u67d0\u79cd\u89c4\u5219\u6765\u5206\u6563\u5230\u591a\u4e2a\u5e93\u4e4b\u4e2d\uff0c\n\u6bcf\u4e2a\u8868\u4e2d \u5305\u542b\u4e00\u90e8\u5206\u6570\u636e\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6570\u636e\u7684\u6c34\u5e73\u5207\u5206\u7406\u89e3\u4e3a\u662f\u6309\u7167\u6570\u636e\u884c\u7684\u5207\u5206\uff0c\u5c31\n\u662f\u5c06\u8868\u4e2d\u7684\u67d0\u4e9b\u884c\u5207\u5206 \u5230\u4e00\u4e2a\u6570\u636e\u5e93\uff0c\u800c\u53e6\u5916\u7684\u67d0\u4e9b\u884c\u53c8\u5207\u5206\u5230\u5176\u4ed6\u7684\u6570\u636e\u5e93\u4e2d\uff0c\u3002\n2020-02-17_144112\n\u5206\u8fa8\u89c4\u5219\u8981\u6839\u636e\u5177\u4f53\u4e1a\u52a1\uff0c\u4ece\u800c\u5177\u4f53\u786e\u5b9a\u3002\n\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 schema.xml\n\u4e3a orders \u8868\u8bbe\u7f6e\u6570\u636e\u8282\u70b9\u4e3a dn1\u3001 dn2\uff0c \u5e76\u6307\u5b9a\u5206\u7247\u89c4\u5219\u4e3a mod_rule\uff08\u81ea\u5b9a\u4e49\u7684\u540d\u5b57\uff09\n\n&lt;table name=\"orders\" dataNode=\"dn1,dn2\" rule=\"mod_rule\" &gt;&lt;/table&gt;\n2020-02-17_150252\n\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 rule.xml\n\n#\u5728 rule \u914d\u7f6e\u6587\u4ef6\u91cc\u65b0\u589e\u5206\u7247\u89c4\u5219 mod_rule\uff0c\u5e76\u6307\u5b9a\u89c4\u5219\u9002\u7528\u5b57\u6bb5\u4e3a customer_id\uff0c\n#\u8fd8\u6709\u9009\u62e9\u5206\u7247\u7b97\u6cd5 mod-long\uff08\u5bf9\u5b57\u6bb5\u6c42\u6a21\u8fd0\u7b97\uff09 \uff0c customer_id \u5bf9\u4e24\u4e2a\u8282\u70b9\u6c42\u6a21\uff0c\u6839\u636e\u7ed3\u679c\u5206\u7247\n#\u914d\u7f6e\u7b97\u6cd5 mod-long \u53c2\u6570 count \u4e3a 2\uff0c\u4e24\u4e2a\u8282\u70b9\n&lt;tableRule name=\"mod_rule\"&gt;\n    &lt;rule&gt;\n          &lt;columns&gt;customer_id&lt;/columns&gt;\n          &lt;algorithm&gt;mod-long&lt;/algorithm&gt;\n    &lt;/rule&gt;\n&lt;/tableRule&gt;\n\u2026\n&lt;function name=\"mod-long\" class=\"io.mycat.route.function.PartitionByMod\"&gt;\n      &lt;!-- how many data nodes --&gt;\n      &lt;property name=\"count\"&gt;2&lt;/property&gt;\n&lt;/function&gt;\n\u5982\u56fe\uff1a\n2020-02-17_150759\n\u7531\u4e8e\u4e4b\u524d\u4e3b\u673a\u4e8c\uff08192.168.2.3\uff09\u6ca1\u6709order\u8868\uff0c\u6240\u4ee5\u9700\u8981\u5148\u624b\u52a8\u521b\u5efa\u8868\u8be5\u8868\u3002\n\u7136\u540e\u542f\u52a8Mycat\u4f7f\u5176\u751f\u6548\u3002\n\u6d4b\u8bd5\u6548\u679c\n\nINSERT INTO orders(id,order_type,customer_id,amount) VALUES (1,101,100,100100);\nINSERT INTO orders(id,order_type,customer_id,amount) VALUES(2,101,100,100300);\nINSERT INTO orders(id,order_type,customer_id,amount) VALUES(3,101,101,120000);\nINSERT INTO orders(id,order_type,customer_id,amount) VALUES(4,101,101,103000);\nINSERT INTO orders(id,order_type,customer_id,amount) VALUES(5,102,101,100400);\nINSERT INTO orders(id,order_type,customer_id,amount) VALUES(6,102,100,100020);\n\u6ce8\u610f\uff1acustomer_id\u5b57\u6bb5**\u4e0d\u80fd\u7701\u7565**\u3002\u56e0\u4e3a\u5206\u8868\u7684\u89c4\u5219\u662f\u4f5c\u7528\u5728\u8be5\u5b57\u6bb5\u4e0a\u9762\u3002\u6ca1\u6709\u8be5\u5b57\u6bb5\uff0c\u89c4\u5219\u4e0d\u4f1a\u751f\u6548\u3002\n\u82e5\u51fa\u73b0\u7ed3\u679c\u4e3a\u4e24\u4e2a\u4e3b\u673a\u7684orders\u8868\u4e2d\u6570\u636e\u5206\u6563\uff0c\u5404\u6709\u6570\u636e\uff0c\u5373\u662f\u6210\u529f\u3002\n\u5206\u8868\u5f15\u51fa\u95ee\u9898\uff1a\n\u95ee\u9898\u4e00\uff1a\u6570\u636e\u5206\u8868\u5b58\u50a8\uff0c\u90a3\u4e48\u67e5\u8be2\u6574\u4f53\u6570\u636e\u65f6\uff0c\u662f\u5982\u4f55\uff1f\n\u7ed3\u679c\u56fe\uff1a\n2020-02-17_152041\n\u6570\u636e\u67e5\u8be2\u7ed3\u679c\uff1a\n2020-02-17_152235\n\u5206\u6790\uff1a\u5982\u4e0a\u9762\u6240\u770b\u5230\uff0c\u4e3b\u673a\u4e00\u5b58\u50a8\u4e3a1\uff0c2\uff0c3\uff0c\u4e3b\u673a\u4e8c\u5b58\u50a8\u4e3a3\uff0c4\uff0c5\uff0c\u67e5\u8be2\u51fa\u4e3a\u6574\u4f53\u4e3a1\uff0c2\uff0c6\uff0c3\uff0c4\uff0c5\u3001\u5373\u662f\u67e5\u8be2\u7684\u7ed3\u679c\u4e3aMycat\u5408\u5e76\u540e\u7684\u7ed3\u679c\u3002\n\u95ee\u9898\u4e8c\uff1a\u5206\u8868\u540e\uff0c\u82e5\u5b9e\u73b0\u548c\u67d0\u4e9b\u7d27\u5bc6\u7684\u8868\u7684join\u64cd\u4f5c\uff0c\u6548\u7387\u548c\u6027\u80fd\u95ee\u9898\u5982\u4f55\u89e3\u51b3\uff1f\nMycat \u501f\u9274\u4e86 NewSQL \u9886\u57df\u7684\u65b0\u79c0 Foundation DB \u7684\u8bbe\u8ba1\u601d\u8def\uff0c Foundation DB \u521b\u65b0\u6027\u7684\u63d0\n\u51fa\u4e86 Table Group \u7684\u6982\u5ff5\uff0c\u5176\u5c06**\u5b50\u8868\u7684\u5b58\u50a8\u4f4d\u7f6e\u4f9d\u8d56\u4e8e\u4e3b\u8868**\uff0c\u5e76\u4e14\u7269\u7406\u4e0a\u7d27\u90bb\u5b58\u653e\uff0c\u56e0\u6b64\u5f7b\u5e95\u89e3\u51b3\u4e86\nJION \u7684\u6548\u7387\u548c\u6027\u80fd\u95ee \u9898\uff0c\u6839\u636e\u8fd9\u4e00\u601d\u8def\uff0c\u63d0\u51fa\u4e86\u57fa\u4e8e E-R \u5173\u7cfb\u7684\u6570\u636e\u5206\u7247\u7b56\u7565\uff0c\u5b50\u8868\u7684\u8bb0\u5f55\u4e0e\u6240\n\u5173\u8054\u7684\u7236\u8868\u8bb0\u5f55\u5b58\u653e\u5728\u540c\u4e00\u4e2a\u6570\u636e\u5206\u7247\u4e0a\u3002\n\u4fee\u6539 schema.xml \u914d\u7f6e\u6587\u4ef6\n\n&lt;table name=\"orders\" dataNode=\"dn1,dn2\" rule=\"mod_rule\" &gt;\n      &lt;childTable name=\"orders_detail\" primaryKey=\"id\" joinKey=\"order_id\" parentKey=\"id\" /&gt;\n&lt;/table&gt;\n\n#\u5728dn2 \u521b\u5efa orders_detail \u8868\n#\u91cd\u542f Mycat\n#\u8bbf\u95ee Mycat \u5411 orders_detail \u8868\u63d2\u5165\u6570\u636e\nINSERT INTO orders_detail(id,detail,order_id) values(1,'detail1',1);\nINSERT INTO orders_detail(id,detail,order_id) VALUES(2,'detail1',2);\nINSERT INTO orders_detail(id,detail,order_id) VALUES(3,'detail1',3);\nINSERT INTO orders_detail(id,detail,order_id) VALUES(4,'detail1',4);\nINSERT INTO orders_detail(id,detail,order_id) VALUES(5,'detail1',5);\nINSERT INTO orders_detail(id,detail,order_id) VALUES(6,'detail1',6);\n#\u5728mycat\u3001 dn1\u3001 dn2\u4e2d\u8fd0\u884c\u4e24\u4e2a\u8868join\u8bed\u53e5\nSelect o.*,od.detail from orders o inner join orders_detail od on o.id=od.order_id;\n\u95ee\u9898\u4e09\uff1a\u5bf9\u4e8e\u8be5\u8868\u6570\u636e\u53d8\u52a8\u4e0d\u5927\uff0c\u4f46\u662f\u5927\u90e8\u5206\u8868\u6709\u4f9d\u8d56\u6b64\u8868\uff0c\u5bf9\u4e8e\u8fd9\u79cd\u8868\uff0c\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff1f\n\u5b57\u5178\u8868\u5177\u6709\u4ee5\u4e0b\u51e0\u4e2a\u7279\u6027\uff1a\n\u200b   \u2460 \u53d8\u52a8\u4e0d\u9891\u7e41\n\u200b   \u2461 \u6570\u636e\u91cf\u603b\u4f53\u53d8\u5316\u4e0d\u5927\n\u200b   \u2462 \u6570\u636e\u89c4\u6a21\u4e0d\u5927\uff0c\u5f88\u5c11\u6709\u8d85\u8fc7\u6570\u5341\u4e07\u6761\u8bb0\u5f55\n\u5168\u5c40\u8868\u5177\u6709\u4ee5\u4e0b\u7279\u6027\uff1a\n\u200b   \u2460 \u5168\u5c40\u8868\u7684\u63d2\u5165\u3001\u66f4\u65b0\u64cd\u4f5c\u4f1a\u5b9e\u65f6\u5728\u6240\u6709\u8282\u70b9\u4e0a\u6267\u884c\uff0c\u4fdd\u6301\u5404\u4e2a\u5206\u7247\u7684\u6570\u636e\u4e00\u81f4\u6027\n\u200b   \u2461 \u5168\u5c40\u8868\u7684\u67e5\u8be2\u64cd\u4f5c\uff0c\u53ea\u4ece\u4e00\u4e2a\u8282\u70b9\u83b7\u53d6\n\u200b   \u2462 \u5168\u5c40\u8868\u53ef\u4ee5\u8ddf\u4efb\u4f55\u4e00\u4e2a\u8868\u8fdb\u884c JOIN \u64cd\u4f5c\n\u4f7f\u7528Mycat\u7684\u5168\u5c40\u8868\u3002\u5373\u662f\u6bcf\u4e00\u4e2a\u4e3b\u673a\u90fd\u6709\u4e00\u4efd\u8be5\u8868\uff0c\u90a3\u4e48\u6bcf\u4e00\u4e2a\u4e3b\u673a\u90fd\u80fd\u591f\u4f7f\u7528\u4e00\u6a21\u4e00\u6837\u7684\u8868\u3002\n\u914d\u7f6e\uff1a\n\u4fee\u6539 schema.xml \u914d\u7f6e\u6587\u4ef6\n\u2026\n&lt;table name=&quot;orders&quot; dataNode=&quot;dn1,dn2&quot; rule=&quot;mod_rule&quot; &gt;\n    &lt;childTable name=&quot;orders_detail&quot; primaryKey=&quot;id&quot; joinKey=&quot;order_id&quot; parentKey=&quot;id&quot; /&gt;\n&lt;/table&gt;\n&lt;table name=&quot;dict_order_type&quot; dataNode=&quot;dn1,dn2&quot; type=&quot;global&quot; &gt;&lt;/table&gt;\n\u2026\n\n\u8be5\u8868\u7684type\u5c5e\u6027\u8bbe\u7f6e\u4e3aglobal\u5373\u53ef\u3002\n\u7531\u4e8e\u4e3b\u673a\u4e8c\u4e4b\u524d\u6ca1\u6709dict_order_type \uff0c\u6240\u4ee5\u9700\u8981\u624b\u52a8\u521b\u5efa\n\u6d4b\u8bd5\uff1a\n\n\u91cd\u542f Mycat\n\u8bbf\u95ee Mycat \u5411 dict_order_type \u8868\u63d2\u5165\u6570\u636e\nINSERT INTO dict_order_type(id,order_type) VALUES(101,'type1');\nINSERT INTO dict_order_type(id,order_type) VALUES(102,'type2'); \n\n\u9884\u671f\u7ed3\u679c\uff1a\n\u5728Mycat\u3001 dn1\u3001 dn2\u4e2d\u67e5\u8be2\u8868\u6570\u636e \u4e00\u6a21\u4e00\u6837\u5373\u53ef\u3002\n\u5e38\u7528\u5206\u7247\u89c4\u5219\n1\u3001 \u53d6\u6a21\n2\u3001 \u5206\u7247\u679a\u4e3e\n3\u3001 \u8303\u56f4\u7ea6\u5b9a\n4\u3001 \u6309\u65e5\u671f\uff08\u5929\uff09\u5206\u7247\n\u53d6\u6a21\uff1a\n\u6b64\u89c4\u5219\u4e3a\u5bf9\u5206\u7247\u5b57\u6bb5\u6c42\u6478\u8fd0\u7b97\u3002 \u4e5f\u662f\u6c34\u5e73\u5206\u8868\u6700\u5e38\u7528\u89c4\u5219\u3002 orders \u8868\u91c7\u7528\u4e86\u6b64\u89c4\u5219\u3002\n\u5206\u7247\u679a\u4e3e\n\u901a\u8fc7\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u53ef\u80fd\u7684\u679a\u4e3e id\uff0c\u81ea\u5df1\u914d\u7f6e\u5206\u7247\uff0c\u672c\u89c4\u5219\u9002\u7528\u4e8e\u7279\u5b9a\u7684\u573a\u666f\uff0c\u6bd4\u5982\u6709\u4e9b\u4e1a\u52a1\n\u9700\u8981\u6309\u7167\u7701\u4efd\u6216\u533a\u53bf\u6765\u505a\u4fdd\u5b58\uff0c\u800c\u5168\u56fd\u7701\u4efd\u533a\u53bf\u56fa\u5b9a\u7684\uff0c\u8fd9\u7c7b\u4e1a\u52a1\u4f7f\u7528\u672c\u6761\u89c4\u5219\n\u914d\u7f6e\uff1a\n\u524d\u8a00\uff1a\u7531\u4e8e\u914d\u7f6e\u548c\u4e4b\u524d\u7684orders\u914d\u7f6e\u6d41\u7a0b\u4e00\u6837\uff0c\u53e4\u4e0b\u9762\u7684\u914d\u7f6e\u90fd\u4ee5\u7b80\u5355\u7684\u914d\u7f6e\uff0c\u5177\u4f53\u53c2\u7167orders\u8ba2\u5355\u8868\u7684\u914d\u7f6e\u5de5\u5382\u3002\n\n\u4fee\u6539schema.xml\u914d\u7f6e\u6587\u4ef6 \u3002\n\n\n&lt;table name=\"orders_ware_info\" dataNode=\"dn1,dn2\" rule=\"sharding_by_intfile\" &gt;&lt;/table&gt;\n\n\u4fee\u6539rule.xml\u914d\u7f6e\u6587\u4ef6 \u3002\n\n&lt;tableRule name=&quot;sharding_by_intfile&quot;&gt;\n      &lt;rule&gt;\n            &lt;columns&gt;areacode&lt;/columns&gt;\n            &lt;algorithm&gt;hash-int&lt;/algorithm&gt;\n      &lt;/rule&gt;\n&lt;/tableRule&gt;\n\u2026\n&lt;function name=&quot;hash-int&quot;  class=&quot;io.mycat.route.function.PartitionByFileMap&quot;&gt;   #\u8fd9\u4e2a\u624d\u662f\u91cd\u70b9\n      &lt;property name=&quot;mapFile&quot;&gt;partition-hash-int.txt&lt;/property&gt;\n      &lt;property name=&quot;type&quot;&gt;1&lt;/property&gt;\n      &lt;property name=&quot;defaultNode&quot;&gt;0&lt;/property&gt;\n&lt;/function&gt;\n\n\u89e3\u6790\uff1a\ncolumns\uff1a\u5206\u7247\u5b57\u6bb5\uff0c algorithm\uff1a\u5206\u7247\u51fd\u6570\nmapFile\uff1a \u6807\u8bc6\u914d\u7f6e\u6587\u4ef6\u540d\u79f0\uff0c type\uff1a 0\u4e3aint\u578b\u3001 \u975e0\u4e3aString\uff0c\ndefaultNode\uff1a \u9ed8\u8ba4\u8282\u70b9:\u5c0f\u4e8e 0 \u8868\u793a\u4e0d\u8bbe\u7f6e\u9ed8\u8ba4\u8282\u70b9\uff0c\u5927\u4e8e\u7b49\u4e8e 0 \u8868\u793a\u8bbe\u7f6e\u9ed8\u8ba4\u8282\u70b9\uff0c\n\u8bbe\u7f6e\u9ed8\u8ba4\u8282\u70b9\u5982\u679c\u78b0\u5230\u4e0d\u8bc6\u522b\u7684\u679a\u4e3e\u503c\uff0c\u5c31\u8ba9\u5b83\u8def\u7531\u5230\u9ed8\u8ba4\u8282\u70b9\uff0c\u5982\u4e0d\u8bbe\u7f6e\u4e0d\u8bc6\u522b\u5c31\u62a5\u9519\n\n\u4fee\u6539partition-hash-int.txt\u914d\u7f6e\u6587\u4ef6\n\n110=0\n120=1\n\n\u91cd\u542f Mycat\n\u8bbf\u95eeMycat\u521b\u5efa\u8868\n\u8ba2\u5355\u5f52\u5c5e\u533a\u57df\u4fe1\u606f\u8868\uff1a\n\n\nCREATE TABLE orders_ware_info\n(\n  `id` INT AUTO_INCREMENT comment &#39;\u7f16\u53f7&#39;,\n  `order_id` INT comment &#39;\u8ba2\u5355\u7f16\u53f7&#39;,\n  `address` VARCHAR(200) comment &#39;\u5730\u5740&#39;,\n  `areacode` VARCHAR(20) comment &#39;\u533a\u57df\u7f16\u53f7&#39;,\n  PRIMARY KEY(id)\n);\n\n\uff086\uff09 \u63d2\u5165\u6570\u636e\nINSERT INTO orders_ware_info(id, order_id,address,areacode) VALUES (1,1,'\u5317\u4eac','110');\nINSERT INTO orders_ware_info(id, order_id,address,areacode) VALUES (2,2,'\u5929\u6d25','120');\n\n\u7ed3\u679c\uff1a\n\n\u9884\u671f\u7ed3\u679c\uff1a\n\u4e24\u4e2a\u4e3b\u673a\u4e0a\u7684\u8868\u6570\u636e\u5206\u522b\u5404\u4e00\u4e2a\u3002\n\n\n\u8303\u56f4\u7ea6\u5b9a\n\u6b64\u5206\u7247\u9002\u7528\u4e8e\uff0c\u63d0\u524d\u89c4\u5212\u597d\u5206\u7247\u5b57\u6bb5\u67d0\u4e2a\u8303\u56f4\u5c5e\u4e8e\u54ea\u4e2a\u5206\u7247\u3002\n\uff081\uff09 \u4fee\u6539schema.xml\u914d\u7f6e\u6587\u4ef6\n\n&lt;table name=\"payment_info\" dataNode=\"dn1,dn2\" rule=\"auto_sharding_long\" &gt;&lt;/table&gt;\n\uff082\uff09 \u4fee\u6539rule.xml\u914d\u7f6e\u6587\u4ef6\n\n&lt;tableRule name=\"auto_sharding_long\"&gt;\n&lt;rule&gt;\n&lt;columns&gt;order_id&lt;/columns&gt;\n&lt;algorithm&gt;rang-long&lt;/algorithm&gt;\n&lt;/rule&gt;\n&lt;/tableRule&gt;\n\u2026\n&lt;function name=\"rang-long\"\nclass=\"io.mycat.route.function.AutoPartitionByLong\"&gt;\n&lt;property name=\"mapFile\"&gt;autopartition-long.txt&lt;/property&gt;\n&lt;property name=\"defaultNode\"&gt;0&lt;/property&gt;\n&lt;/function&gt;\ncolumns\uff1a\u5206\u7247\u5b57\u6bb5\uff0c algorithm\uff1a\u5206\u7247\u51fd\u6570\nmapFile\uff1a \u6807\u8bc6\u914d\u7f6e\u6587\u4ef6\u540d\u79f0\uff0c type\uff1a 0\u4e3aint\u578b\u3001 \u975e0\u4e3aString\uff0c\ndefaultNode\uff1a \u9ed8\u8ba4\u8282\u70b9:\u5c0f\u4e8e 0 \u8868\u793a\u4e0d\u8bbe\u7f6e\u9ed8\u8ba4\u8282\u70b9\uff0c\u5927\u4e8e\u7b49\u4e8e 0 \u8868\u793a\u8bbe\u7f6e\u9ed8\u8ba4\u8282\u70b9\uff0c\n\u8bbe\u7f6e\u9ed8\u8ba4\u8282\u70b9\u5982\u679c\u78b0\u5230\u4e0d\u8bc6\u522b\u7684\u679a\u4e3e\u503c\uff0c\u5c31\u8ba9\u5b83\u8def\u7531\u5230\u9ed8\u8ba4\u8282\u70b9\uff0c\u5982\u4e0d\u8bbe\u7f6e\u4e0d\u8bc6\u522b\u5c31\u62a5\u9519\n\uff083\uff09 \u4fee\u6539autopartition-long.txt\u914d\u7f6e\u6587\u4ef6\n\n0-102=0\n103-200=1\n\uff084\uff09 \u91cd\u542f Mycat\n\uff085\uff09 \u8bbf\u95eeMycat\u521b\u5efa\u8868\n\u652f\u4ed8\u4fe1\u606f\u8868\n\nCREATE TABLE payment_info\n(\n`id` INT AUTO_INCREMENT comment '\u7f16\u53f7',\n`order_id` INT comment '\u8ba2\u5355\u7f16\u53f7',\n`payment_status` INT comment '\u652f\u4ed8\u72b6\u6001',\nPRIMARY KEY(id)\n);\n\uff086\uff09 \u63d2\u5165\u6570\u636e\n\nINSERT INTO payment_info (id,order_id,payment_status) VALUES (1,101,0);\nINSERT INTO payment_info (id,order_id,payment_status) VALUES (2,102,1);\nINSERT INTO payment_info (id,order_id ,payment_status) VALUES (3,103,0);\nINSERT INTO payment_info (id,order_id,payment_status) VALUES (4,104,1);\n\uff087\uff09 \u9884\u671f\u7ed3\u679c\uff1a\n\u4e3b\u673a\u4e00\u548c\u4e3b\u673a\u4e8c\u7684\u8868\u4e0a\u5404\u6709\u4e00\u4e2a\u6570\u636e\u3002\n\u6309\u65e5\u671f\uff08\u5929\uff09\u5206\u7247\n\u6b64\u89c4\u5219\u4e3a\u6309\u5929\u5206\u7247\u3002 \u8bbe\u5b9a\u65f6\u95f4\u683c\u5f0f\u3001\u8303\u56f4\n\uff081\uff09 \u4fee\u6539schema.xml\u914d\u7f6e\u6587\u4ef6\n\n&lt;table name=\"login_info\" dataNode=\"dn1,dn2\" rule=\"sharding_by_date\" &gt;&lt;/table&gt;\n\uff082\uff09 \u4fee\u6539rule.xml\u914d\u7f6e\u6587\u4ef6\n\n&lt;tableRule name=\"sharding_by_date\"&gt;\n    &lt;rule&gt;\n        &lt;columns&gt;login_date&lt;/columns&gt;\n        &lt;algorithm&gt;shardingByDate&lt;/algorithm&gt;\n    &lt;/rule&gt;\n&lt;/tableRule&gt;\n\u2026\n&lt;function name=\"shardingByDate\" class=\"io.mycat.route.function.PartitionByDate\"&gt;\n      &lt;property name=\"dateFormat\"&gt;yyyy-MM-dd&lt;/property&gt;\n      &lt;property name=\"sBeginDate\"&gt;2019-01-01&lt;/property&gt;\n      &lt;property name=\"sEndDate\"&gt;2019-01-04&lt;/property&gt; \n      &lt;property name=\"sPartionDay\"&gt;2&lt;/property&gt;\n&lt;/function&gt;\ncolumns\uff1a\u5206\u7247\u5b57\u6bb5\uff0c algorithm\uff1a\u5206\u7247\u51fd\u6570\ndateFormat \uff1a\u65e5\u671f\u683c\u5f0f\nsBeginDate \uff1a\u5f00\u59cb\u65e5\u671f\nsEndDate\uff1a\u7ed3\u675f\u65e5\u671f,\u5219\u4ee3\u8868\u6570\u636e\u8fbe\u5230\u4e86\u8fd9\u4e2a\u65e5\u671f\u7684\u5206\u7247\u540e\u5faa\u73af\u4ece\u5f00\u59cb\u5206\u7247\u63d2\u5165\nsPartionDay \uff1a\u5206\u533a\u5929\u6570\uff0c\u5373\u9ed8\u8ba4\u4ece\u5f00\u59cb\u65e5\u671f\u7b97\u8d77\uff0c\u5206\u9694 2 \u5929\u4e00\u4e2a\u5206\u533a\n\uff083\uff09 \u91cd\u542f Mycat\n\uff084\uff09 \u8bbf\u95eeMycat\u521b\u5efa\u8868\n\u7528\u6237\u4fe1\u606f\u8868\n\nCREATE TABLE login_info\n(\n    `id` INT AUTO_INCREMENT comment '\u7f16\u53f7',\n    `user_id` INT comment '\u7528\u6237\u7f16\u53f7',\n    `login_date` date comment '\u767b\u5f55\u65e5\u671f',\n    PRIMARY KEY(id)\n);\n\uff086\uff09 \u63d2\u5165\u6570\u636e\n\nINSERT INTO login_info(id,user_id,login_date) VALUES (1,101,'2019-01-01');\nINSERT INTO login_info(id,user_id,login_date) VALUES (2,102,'2019-01-02');\nINSERT INTO login_info(id,user_id,login_date) VALUES (3,103,'2019-01-03');\nINSERT INTO login_info(id,user_id,login_date) VALUES (4,104,'2019-01-04');\nINSERT INTO login_info(id,user_id,login_date) VALUES (5,103,'2019-01-05');\nINSERT INTO login_info(id,user_id,login_date) VALUES (6,104,'2019-01-06');\n\u7ed3\u679c\uff1a\u4e24\u4e2a\u6570\u636e\u5e93\u4e2d\u8868\u5404\u6709\u6570\u636e\u3002\n\u5168\u5c40\u5e8f\u5217\n\u5728\u5b9e\u73b0\u5206\u5e93\u5206\u8868\u7684\u60c5\u51b5\u4e0b\uff0c\u6570\u636e\u5e93\u81ea\u589e\u4e3b\u952e\u5df2\u65e0\u6cd5\u4fdd\u8bc1\u81ea\u589e\u4e3b\u952e\u7684\u5168\u5c40\u552f\u4e00\u3002\u4e3a\u6b64\uff0c Mycat \u63d0\u4f9b\n\u4e86\u5168\u5c40 sequence\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e86\u5305\u542b\u672c\u5730\u914d\u7f6e\u548c\u6570\u636e\u5e93\u914d\u7f6e\u7b49\u591a\u79cd\u5b9e\u73b0\u65b9\u5f0f\n1\u3001 \u672c\u5730\u6587\u4ef6 \uff1a\n2\u3001 \u6570\u636e\u5e93\u65b9\u5f0f\n3\u3001 \u65f6\u95f4\u6233\u65b9\u5f0f\n4\u3001 \u81ea\u4e3b\u751f\u6210\u5168\u5c40\u5e8f\u5217\n\u672c\u5730\u6587\u4ef6\u65b9\u5f0f\n\u53c2\u8003\u5b98\u65b9\u6587\u6863\uff1aP106\u9875\n\u539f\u7406\uff1a \u6b64\u65b9\u5f0f MyCAT \u5c06 sequence \u914d\u7f6e\u5230\u6587\u4ef6\u4e2d\uff0c\u5f53\u4f7f\u7528\u5230 sequence \u4e2d\u7684\u914d\u7f6e\u540e\uff0c MyCAT \u4f1a\u66f4\u4e0b\nclasspath \u4e2d\u7684 sequence_conf.properties \u6587\u4ef6\u4e2d sequence \u5f53\u524d\u7684\u503c\u3002\n\u914d\u7f6e\u65b9\u5f0f\uff1a\n\u5728 sequence_conf.properties \u6587\u4ef6\u4e2d\u505a\u5982\u4e0b\u914d\u7f6e\uff1a\n\nGLOBAL_SEQ.HISIDS=\nGLOBAL_SEQ.MINID=1001\nGLOBAL_SEQ.MAXID=1000000000\nGLOBAL_SEQ.CURID=1000\n\u5176\u4e2d HISIDS \u8868\u793a\u4f7f\u7528\u8fc7\u7684\u5386\u53f2\u5206\u6bb5(\u4e00\u822c\u65e0\u7279\u6b8a\u9700\u8981\u53ef\u4e0d\u914d\u7f6e)\uff0c MINID \u8868\u793a\u6700\u5c0f ID \u503c\uff0c MAXID \u8868\u793a\u6700\u5927\nID \u503c\uff0c CURID \u8868\u793a\u5f53\u524d ID \u503c\u3002\nserver.xml \u4e2d\u914d\u7f6e\uff1a\n\n&lt;system&gt;&lt;property name=\"sequnceHandlerType\"&gt;0&lt;/property&gt;&lt;/system&gt;\n\u6ce8\uff1a sequnceHandlerType \u9700\u8981\u914d\u7f6e\u4e3a 0\uff0c\u8868\u793a\u4f7f\u7528\u672c\u5730\u6587\u4ef6\u65b9\u5f0f\u3002\n\u4f7f\u7528\u793a\u4f8b\uff1a\n\ninsert into table1(id,name) values(next value for MYCATSEQ_GLOBAL,\u2018test\u2019);\n\u7f3a\u70b9\uff1a\u5f53 MyCAT \u91cd\u65b0\u53d1\u5e03\u540e\uff0c\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 sequence \u4f1a\u6062\u590d\u5230\u521d\u59cb\u503c\u3002\n\u4f18\u70b9\uff1a\u672c\u5730\u52a0\u8f7d\uff0c\u8bfb\u53d6\u901f\u5ea6\u8f83\u5feb\n\u6570\u636e\u5e93\u65b9\u5f0f\n\u539f\u7406 :\n\u5728\u6570\u636e\u5e93\u4e2d\u5efa\u7acb\u4e00\u5f20\u8868\uff0c\u5b58\u653e sequence \u540d\u79f0(name)\uff0c sequence \u5f53\u524d\u503c(current_value)\uff0c\u6b65\u957f(increment\nint \u7c7b\u578b\u6bcf\u6b21\u8bfb\u53d6\u591a\u5c11\u4e2a sequence\uff0c\u5047\u8bbe\u4e3a K)\u7b49\u4fe1\u606f\uff1b\nSequence \u83b7\u53d6\u6b65\u9aa4\uff1a\n1). \u5f53\u521d\u6b21\u4f7f\u7528\u8be5 sequence \u65f6\uff0c\u6839\u636e\u4f20\u5165\u7684 sequence \u540d\u79f0\uff0c\u4ece\u6570\u636e\u5e93\u8fd9\u5f20\u8868\u4e2d\u8bfb\u53d6 current_value\uff0c\u548c\nincrement \u5230 MyCat \u4e2d\uff0c\u5e76\u5c06\u6570\u636e\u5e93\u4e2d\u7684 current_value \u8bbe\u7f6e\u4e3a\u539f current_value \u503c+increment \u503c\u3002\n\u200b   MyCat \u5c06\u8bfb\u53d6\u5230 current_value+increment \u4f5c\u4e3a\u672c\u6b21\u8981\u4f7f\u7528\u7684 sequence \u503c\uff0c\u4e0b\u6b21\u4f7f\u7528\u65f6\uff0c\u81ea\u52a8\u52a0 1\uff0c\u5f53\n\u4f7f\u7528 increment \u6b21\u540e\uff0c\u6267\u884c\u6b65\u9aa4 1)\u76f8\u540c\u7684\u64cd\u4f5c\u3002\n\u200b   MyCat \u8d1f\u8d23\u7ef4\u62a4\u8fd9\u5f20\u8868\uff0c\u7528\u5230\u54ea\u4e9b sequence\uff0c\u53ea\u9700\u8981\u5728\u8fd9\u5f20\u8868\u4e2d\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\u5373\u53ef\u3002 \u82e5\u67d0\u6b21\u8bfb\u53d6\u7684\nsequence \u6ca1\u6709\u7528\u5b8c\uff0c\u7cfb\u7edf\u5c31\u505c\u6389\u4e86\uff0c\u5219\u8fd9\u6b21\u8bfb\u53d6\u7684 sequence \u5269\u4f59\u503c\u4e0d\u4f1a\u518d\u4f7f\u7528\u3002\n\u914d\u7f6e\n\u914d\u7f6e\u65b9\u5f0f\uff1a\nserver.xml \u914d\u7f6e\uff1a\n\n&lt;system&gt;&lt;property name=\"sequnceHandlerType\"&gt;1&lt;/property&gt;&lt;/system&gt;\n\u6ce8\uff1a sequnceHandlerType \u9700\u8981\u914d\u7f6e\u4e3a 1\uff0c\u8868\u793a\u4f7f\u7528\u6570\u636e\u5e93\u65b9\u5f0f\u751f\u6210 sequence\u3002\n\u8865\u5145\uff1a \u5168\u5c40\u5e8f\u5217\u7c7b\u578b\uff1a 0-\u672c\u5730\u6587\u4ef6\uff0c 1-\u6570\u636e\u5e93\u65b9\u5f0f\uff0c 2-\u65f6\u95f4\u6233\u65b9\u5f0f\u3002\n\u6570\u636e\u5e93\u914d\u7f6e\uff1a\n1) \u521b\u5efa MYCAT_SEQUENCE \u8868\nDROP TABLE IF EXISTS MYCAT_SEQUENCE;    #\u521b\u5efa\u5b58\u653e sequence \u7684\u8868\n# name sequence \u540d\u79f0\n# current_value \u5f53\u524d value\n# increment \u589e\u957f\u6b65\u957f! \u53ef\u7406\u89e3\u4e3a mycat \u5728\u6570\u636e\u5e93\u4e2d\u4e00\u6b21\u8bfb\u53d6\u591a\u5c11\u4e2a sequence. \u5f53\u8fd9\u4e9b\u7528\u5b8c\u540e, \u4e0b\u6b21\u518d\u4ece\u6570\n#\u636e\u5e93\u4e2d\u8bfb\u53d6\u3002\nCREATE TABLE MYCAT_SEQUENCE (\n    name VARCHAR(50) NOT NULL,\n    current_value INT NOT NULL,\n    increment INT NOT NULL DEFAULT 100,\n    PRIMARY KEY(name)\n) ENGINE=InnoDB;\n# \u63d2\u5165\u4e00\u6761 sequence\nINSERT INTO MYCAT_SEQUENCE(name,current_value,increment)\nVALUES (\u2018GLOBAL\u2019, 100000,100);\n\n2) \u521b\u5efa\u76f8\u5173 function\n# \u83b7\u53d6\u5f53\u524d sequence \u7684\u503c (\u8fd4\u56de\u5f53\u524d\u503c,\u589e\u91cf)\nDROP FUNCTION IF EXISTS mycat_seq_currval;\nDELIMITER\nCREATE FUNCTION mycat_seq_currval(seq_name VARCHAR(50)) RETURNS varchar(64) CHARSET utf-8\nDETERMINISTIC\nBEGIN\n    DECLARE retval VARCHAR(64);\n    SET retval=\u201c-999999999,null\u201d;\n    SELECT concat(CAST(current_value AS CHAR),\u201c,\u201d,CAST(increment AS CHAR)) INTO retval FROM\n    MYCAT_SEQUENCE WHERE name = seq_name;\n    RETURN retval;\nEND\nDELIMITER;\n# \u8bbe\u7f6e sequence \u503c\nDROP FUNCTION IF EXISTS mycat_seq_setval;\nDELIMITER\n  CREATE FUNCTION mycat_seq_setval(seq_name VARCHAR(50),value INTEGER) RETURNS varchar(64)\n  CHARSET utf-8\nDETERMINISTIC\nBEGIN\n    UPDATE MYCAT_SEQUENCE\n    SET current_value = value\n    WHERE name = seq_name;\n    RETURN mycat_seq_currval(seq_name);\nEND\nDELIMITER;\n# \u83b7\u53d6\u4e0b\u4e00\u4e2a sequence \u503c\nDROP FUNCTION IF EXISTS mycat_seq_nextval;\nDELIMITER\nCREATE FUNCTION mycat_seq_nextval(seq_name VARCHAR(50)) RETURNS varchar(64) CHARSET\nutf-8\nDETERMINISTIC\nBEGIN\n    UPDATE MYCAT_SEQUENCE\n    SET current_value = current_value + increment WHERE name = seq_name;\n    RETURN mycat_seq_currval(seq_name);\nEND\nDELIMITER;\n\n4) sequence_db_conf.properties \u76f8\u5173\u914d\u7f6e,\u6307\u5b9a sequence \u76f8\u5173\u914d\u7f6e\u5728\u54ea\u4e2a\u8282\u70b9\u4e0a\uff1a\n\u4f8b\u5982\uff1a\n\nUSER_SEQ=test_dn1\n\u6ce8\u610f\uff1a MYCAT_SEQUENCE \u8868\u548c\u4ee5\u4e0a\u7684 3 \u4e2a function\uff0c \u9700\u8981\u653e\u5728\u540c\u4e00\u4e2a\u8282\u70b9\u4e0a\u3002 function \u8bf7\u76f4\u63a5\u5728\u5177\u4f53\u8282\n\u70b9\u7684\u6570\u636e\u5e93\u4e0a\u6267\u884c\uff0c\u5982\u679c\u6267\u884c\u7684\u65f6\u5019\u62a5\uff1ayou might want to use the less safe log_bin_trust_function_creators variable\u9700\u8981\u5bf9\u6570\u636e\u5e93\u505a\u5982\u4e0b\u8bbe\u7f6e\uff1a\nwindows \u4e0b my.ini[mysqld]\u52a0\u4e0a log_bin_trust_function_creators=1\nlinux \u4e0b/etc/my.cnf \u4e0b my.ini[mysqld]\u52a0\u4e0a log_bin_trust_function_creators=1\n\u4fee\u6539\u5b8c\u540e\uff0c\u5373\u53ef\u5728 mysql \u6570\u636e\u5e93\u4e2d\u6267\u884c\u4e0a\u9762\u7684\u51fd\u6570\u3002\n\u4f7f\u7528\u793a\u4f8b\uff1a\n\ninsert into table1(id,name) values(next value for MYCATSEQ_GLOBAL,\u2018test\u2019)\uff1b\n\u672c\u5730\u65f6\u95f4\u6233\u65b9\u5f0f\nID= 64 \u4f4d\u4e8c\u8fdb\u5236 (42(\u6beb\u79d2)+5(\u673a\u5668 ID)+5(\u4e1a\u52a1\u7f16\u7801)+12(\u91cd\u590d\u7d2f\u52a0)\n\u6362\u7b97\u6210\u5341\u8fdb\u5236\u4e3a 18 \u4f4d\u6570\u7684 long \u7c7b\u578b\uff0c\u6bcf\u6beb\u79d2\u53ef\u4ee5\u5e76\u53d1 12 \u4f4d\u4e8c\u8fdb\u5236\u7684\u7d2f\u52a0\u3002\n\u4f7f\u7528\u65b9\u5f0f\uff1a\na. \u914d \u7f6e server.xml\n\n&lt;property name=\"sequnceHandlerType\"&gt;2&lt;/property&gt;\nb. \u5728 mycat \u4e0b\u914d\u7f6e\uff1a sequence_time_conf.properties\n\nWORKID=0-31 #\u4efb\u610f\u6574\u6570\nDATAACENTERID=0-31 #\u4efb\u610f\u6574\u6570\n\u591a\u4e2a\u4e2a mycat \u8282\u70b9\u4e0b\u6bcf\u4e2a mycat \u914d\u7f6e\u7684 WORKID\uff0c DATAACENTERID \u4e0d\u540c\uff0c\u7ec4\u6210\u552f\u4e00\u6807\u8bc6\uff0c\u603b\u5171\u652f\u6301\n32*32=1024 \u79cd\u7ec4\u5408\u3002\nID \u793a\u4f8b\uff1a 56763083475511\n\u2460 \u4f18\u70b9\uff1a \u914d\u7f6e\u7b80\u5355\n\u2461 \u7f3a\u70b9\uff1a 18 \u4f4d ID \u8fc7\u957f\n\u5176\u4ed6\u65b9\u5f0f\n\nZk \u9012\u589e\u65b9\u5f0f\n\u4f7f\u7528 catelet \u6ce8\u89e3\u65b9\u5f0f \n\u5229\u7528 zookeeper \u65b9\u5f0f\u5b9e\u73b0  \n\n\u57fa\u4e8e HA \u673a\u5236\u7684 Mycat \u9ad8\u53ef\u7528\n\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c Mycat \u670d\u52a1\u4e5f\u9700\u8981\u8003\u8651\u9ad8\u53ef\u7528\u6027\uff0c\u5982\u679c Mycat \u6240\u5728\u670d\u52a1\u5668\u51fa\u73b0\u5b95\u673a\uff0c\u6216 Mycat \u670d\n\u52a1\u6545\u969c\uff0c\u9700\u8981\u6709\u5907\u673a\u63d0\u4f9b\u670d\u52a1\uff0c\u9700\u8981\u8003\u8651 Mycat \u96c6\u7fa4\u3002\n\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 HAProxy + Keepalived \u914d\u5408\u4e24\u53f0 Mycat \u642d\u8d77 Mycat \u96c6\u7fa4\uff0c\u5b9e\u73b0\u9ad8\u53ef\u7528\u6027\u3002 HAProxy\n\u5b9e\u73b0\u4e86 MyCat \u591a\u8282\u70b9\u7684\u96c6\u7fa4\u9ad8\u53ef\u7528\u548c\u8d1f\u8f7d\u5747\u8861\uff0c \u800c HAProxy \u81ea\u8eab\u7684\u9ad8\u53ef\u7528\u5219\u53ef\u4ee5\u901a\u8fc7 Keepalived \u6765\n\u5b9e\u73b0\u3002\n2020-02-17_200311\nuse3\n\u5b89\u88c5\u914d\u7f6e HAProxy\n#1\u51c6\u5907\u597dHAProxy\u5b89\u88c5\u5305\uff0c\u4f20\u5230/opt\u76ee\u5f55\u4e0b\n\n#2\u89e3\u538b\u5230/usr/local/src\n  tar -zxvf haproxy-1.5.18.tar.gz -C /usr/local/src\n\n#3\u8fdb\u5165\u89e3\u538b\u540e\u7684\u76ee\u5f55\uff0c\u67e5\u770b\u5185\u6838\u7248\u672c\uff0c \u8fdb\u884c\u7f16\u8bd1\n  cd /usr/local/src/haproxy-1.5.18\n  uname -r\n  make TARGET=linux310 PREFIX=/usr/local/haproxy  ARCH=x86_64\n# ARGET=linux310\uff0c\u5185\u6838\u7248\u672c\uff0c\u4f7f\u7528uname -r\u67e5\u770b\u5185\u6838\uff0c\u5982\uff1a 3.10.0-514.el7\uff0c\u6b64\u65f6\u8be5\u53c2\u6570\u5c31\u4e3alinux310\uff1b\n# ARCH=x86_64\uff0c\u7cfb\u7edf\u4f4d\u6570\uff1b\n# PREFIX=/usr/local/haprpxy #/usr/local/haprpxy\uff0c\u4e3ahaprpxy\u5b89\u88c5\u8def\u5f84\u3002\n\n#4\u7f16\u8bd1\u5b8c\u6210\u540e\uff0c\u8fdb\u884c\u5b89\u88c5\n  make install PREFIX=/usr/local/haproxy\n#5\u5b89\u88c5\u5b8c\u6210\u540e\uff0c \u521b\u5efa\u76ee\u5f55\u3001 \u521b\u5efaHAProxy\u914d\u7f6e\u6587\u4ef6\n  mkdir -p /usr/data/haproxy/\n  vim /usr/local/haproxy/haproxy.conf\n#6\u5411\u914d\u7f6e\u6587\u4ef6\u4e2d\u63d2\u5165\u4ee5\u4e0b\u914d\u7f6e\u4fe1\u606f,\u5e76\u4fdd\u5b58\nglobal\n    log 127.0.0.1 local0\n    #log 127.0.0.1 local1 notice\n    #log loghost local0 info\n    maxconn 4096\n    chroot /usr/local/haproxy     #\n    pidfile /usr/data/haproxy/haproxy.pid   #\n    uid 99\n    gid 99\n    daemon\n    #debug\n    #quiet\ndefaults\n     log   global\n     mode tcp\n     option  abortonclose\n     option  redispatch\n     retries  3\n     maxconn  2000\n     timeout  connect 5000\n     timeout  client 50000\n     timeout  server 50000\nlisten proxy_status\n    bind :48066\n        mode tcp\n        balance roundrobin\n        server mycat_1 192.168.2.2:8066 check inter 10s    #mycat\u6240\u5728\u7684ip\n        server mycat_2 192.168.2.3:8066 check inter 10s    #mycat\u6240\u5728\u7684ip\nfrontend admin_stats\n    bind :7777\n        mode http\n        stats enable\n        option httplog\n        maxconn 10\n        stats refresh 30s\n        stats uri /admin    #\u6d4f\u89c8\u8bbf\u95ee\u65f6\u8981\u52a0\u7684\u540e\u7f00\n        stats auth admin:123123   #\u8d26\u53f7  \u5bc6\u7801\n        stats hide-version\n        stats admin if TRUE\n\n\n\u542f\u52a8HAProxy\n\n\n/usr/local/haproxy/sbin/haproxy -f /usr/local/haproxy/haproxy.conf\n\n\u67e5\u770bHAProxy\u8fdb\u7a0b\n\n\nps -ef|grep haproxy\n\n\u6253\u5f00\u6d4f\u89c8\u5668\u8bbf\u95ee\n\nhttp://192.168.140.125:7777/admin\n\u5728\u5f39\u51fa\u6846\u8f93\u5165\u7528\u6237\u540d\uff1a admin\u5bc6\u7801\uff1a 123123\n2020-02-17_202031\n\n\u9a8c\u8bc1\u8d1f\u8f7d\u5747\u8861\uff0c\u901a\u8fc7HAProxy\u8bbf\u95eeMycat\n\n\nmysql -umycat -p123456 -h 192.168.140.126 -P 48066\n\u914d\u7f6e Keepalived\n#1\u51c6\u5907\u597dKeepalived\u5b89\u88c5\u5305\uff0c\u4f20\u5230/opt\u76ee\u5f55\u4e0b\n#2\u89e3\u538b\u5230/usr/local/src\ntar -zxvf keepalived-1.4.2.tar.gz -C /usr/local/src\n#3\u5b89\u88c5\u4f9d\u8d56\u63d2\u4ef6\nyum install -y gcc openssl-devel popt-devel\n#3\u8fdb\u5165\u89e3\u538b\u540e\u7684\u76ee\u5f55\uff0c \u8fdb\u884c\u914d\u7f6e\uff0c \u8fdb\u884c\u7f16\u8bd1\ncd /usr/local/src/keepalived-1.4.2\n./configure --prefix=/usr/local/keepalived\n#4\u8fdb\u884c\u7f16\u8bd1\uff0c \u5b8c\u6210\u540e\u8fdb\u884c\u5b89\u88c5\nmake &amp;&amp; make install\n#5\u8fd0\u884c\u524d\u914d\u7f6e\ncp /usr/local/src/keepalived-1.4.2/keepalived/etc/init.d/keepalived /etc/init.d/\nmkdir /etc/keepalived\ncp /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/\ncp /usr/local/src/keepalived-1.4.2/keepalived/etc/sysconfig/keepalived /etc/sysconfig/\ncp /usr/local/keepalived/sbin/keepalived /usr/sbin/\n#6\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\nvim /etc/keepalived/keepalived.conf\n\n#\u4fee\u6539\u5185\u5bb9\u5982\u4e0b\n!Configuration File for keepalived\nglobal_defs {\n    notification_email {\n        xlcocoon@foxmail.com\n    }\n    notification_email_from keepalived@showjoy.com\n    smtp_server 127.0.0.1\n    smtp_connect_timeout 30\n    router_id LVS_DEVEL\n    vrrp_skip_check_adv_addr\n    vrrp_garp_interval 0\n    vrrp_gna_interval 0\n}\nvrrp_instance VI_1 {\n    #\u4e3b\u673a\u914dMASTER\uff0c\u5907\u673a\u914dBACKUP,\u8fd9\u4e2a\u662f\u4e3b\u673a\uff0c\u6240\u4ee5\u662fmaster\n    state MASTER\n    #\u6240\u5728\u673a\u5668\u7f51\u5361\n    interface ens33\n    virtual_router_id 51\n    #\u6570\u503c\u8d8a\u5927\u4f18\u5148\u7ea7\u8d8a\u9ad8\n    priority 100\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass 1111\n    }\n    virtual_ipaddress {\n        #\u865a\u62dfIP\n        192.168.140.200\n    }\n}\nvirtual_server 192.168.140.200 48066 {\n    delay_loop 6\n    lb_algo rr\n    lb_kind NAT\n    persistence_timeout 50\n    protocol TCP\n    real_server 192.168.2.2 48066 {\n        weight 1\n        TCP_CHECK {\n            connect_timeout 3\n            retry 3\n            delay_before_retry 3\n         }\n    }\nreal_server 192.168.2.3 48600 {\n    weight 1\n    TCP_CHECK {\n        connect_timeout 3\n        nb_get_retry 3\n        delay_before_retry 3\n    }  \n  }\n}\n\n\u542f\u52a8\uff1a\n\n#1\u542f\u52a8Keepalived\nservice keepalived start\n#2\u767b\u5f55\u9a8c\u8bc1\nmysql -umycat -p123456 -h 192.168.140.200 -P 48066\n\u6d4b\u8bd5\uff1a\n\n#1\u5173\u95edmycat\n#2\u901a\u8fc7\u865a\u62dfip\u67e5\u8be2\u6570\u636e\nmysql -umycat -p123456 -h 192.168.140.200 -P 48066\n\u6743\u9650\u63a7\u5236\n1\u3001 user \u6807\u7b7e\u6743\u9650\u63a7\u5236\n\u76ee\u524d Mycat \u5bf9\u4e8e\u4e2d\u95f4\u4ef6\u7684\u8fde\u63a5\u63a7\u5236\u5e76\u6ca1\u6709\u505a\u592a\u590d\u6742\u7684\u63a7\u5236\uff0c\u76ee\u524d\u53ea\u505a\u4e86\u4e2d\u95f4\u4ef6\u903b\u8f91\u5e93\u7ea7\u522b\u7684\u8bfb\n\u5199\u6743\u9650\u63a7\u5236\u3002\u662f\u901a\u8fc7 server.xml \u7684 user \u6807\u7b7e\u8fdb\u884c\u914d\u7f6e\u3002\n\u5982\u4e0b\uff1a\n\n&lt;user name=\"mycat\"&gt;\n    &lt;property name=\"password\"&gt;123456&lt;/property&gt;\n    &lt;property name=\"schemas\"&gt;TESTDB&lt;/property&gt;\n&lt;/user&gt;\n&lt;user name=\"user\"&gt;\n    &lt;property name=\"password\"&gt;user&lt;/property&gt;\n    &lt;property name=\"schemas\"&gt;TESTDB&lt;/property&gt;\n    &lt;property name=\"readOnly\"&gt;true&lt;/property&gt;\n&lt;/user&gt;\n\u914d\u7f6e\u8bf4\u660e\n\n\n\u6807\u7b7e\u5c5e\u6027\n\u8bf4\u660e\n\n\n\n\nname\n\u5e94\u7528\u8fde\u63a5\u4e2d\u95f4\u4ef6\u903b\u8f91\u5e93\u7684\u7528\u6237\u540d\n\n\npassword\n\u8be5\u7528\u6237\u5bf9\u5e94\u7684\u5bc6\u7801\n\n\nTESTDB\n\u5e94\u7528\u5f53\u524d\u8fde\u63a5\u7684\u903b\u8f91\u5e93\u4e2d\u6240\u5bf9\u5e94\u7684\u903b\u8f91\u8868\u3002 schemas \u4e2d\u53ef\u4ee5\u914d\u7f6e\u4e00\u4e2a\u6216\u591a\u4e2a\n\n\nreadOnly\n\u5e94\u7528\u8fde\u63a5\u4e2d\u95f4\u4ef6\u903b\u8f91\u5e93\u6240\u5177\u6709\u7684\u6743\u9650\u3002 true \u4e3a\u53ea\u8bfb\uff0c false \u4e3a\u8bfb\u5199\u90fd\u6709\uff0c\u9ed8\u8ba4\u4e3a false\n\n\n\n2\u3001 privileges \u6807\u7b7e\u6743\u9650\u63a7\u5236\n\u5728 user \u6807\u7b7e\u4e0b\u7684 privileges \u6807\u7b7e\u53ef\u4ee5\u5bf9\u903b\u8f91\u5e93\uff08schema\uff09\u3001\u8868\uff08table\uff09\u8fdb\u884c\u7cbe\u7ec6\u5316\u7684 DML \u6743\u9650\u63a7\n\u5236\u3002privileges \u6807\u7b7e\u4e0b\u7684 check \u5c5e\u6027\uff0c\u5982\u4e3a *true \u5f00\u542f\u6743\u9650\u68c0\u67e5\uff0c\u4e3a false \u4e0d\u5f00\u542f*\uff0c\u9ed8\u8ba4\u4e3a false\u3002\n\u7531\u4e8e Mycat \u4e00\u4e2a\u7528\u6237\u7684 schemas \u5c5e\u6027\u53ef\u914d\u7f6e\u591a\u4e2a\u903b\u8f91\u5e93\uff08schema\uff09 \uff0c\u6240\u4ee5 privileges \u7684\u4e0b\u7ea7\n\u8282\u70b9 schema \u8282\u70b9\u540c\u6837\u53ef\u914d\u7f6e\u591a\u4e2a\uff0c\u5bf9\u591a\u5e93\u591a\u8868\u8fdb\u884c\u7ec6\u7c92\u5ea6\u7684 DML \u6743\u9650\u63a7\u5236\u3002\n\u4f8b\u5982\uff1a\n&lt;user name=&quot;mycat&quot;&gt;\n    &lt;property name=&quot;password&quot;&gt;123456&lt;/property&gt;\n    &lt;property name=&quot;schemas&quot;&gt;TESTDB&lt;/property&gt;\n    &lt;!-- \u8868\u7ea7 DML \u6743\u9650\u8bbe\u7f6e --&gt;\n    &lt;privileges check=&quot;true&quot;&gt;\n        &lt;schema name=&quot;TESTDB&quot; dml=&quot;1111&quot; &gt;\n              &lt;table name=&quot;orders&quot; dml=&quot;0000&quot;&gt;&lt;/table&gt;\n              &lt;!--&lt;table name=&quot;tb02&quot; dml=&quot;1111&quot;&gt;&lt;/table&gt;--&gt;\n        &lt;/schema&gt;\n    &lt;/privileges&gt;\n&lt;/user&gt;\n\n\u914d\u7f6e\u8bf4\u660e\n\n\nDML \u6743\u9650\n\u589e\u52a0\uff08insert\uff09\n\u66f4\u65b0\uff08update\uff09\n\u67e5\u8be2\uff08select\uff09\n\u5220\u9664\uff08select\uff09\n\n\n\n\n0000\n\u7981\u6b62\n\u7981\u6b62\n\u7981\u6b62\n\u7981\u6b62\n\n\n0010\n\u7981\u6b62\n\u7981\u6b62\n\u53ef\u4ee5\n\u7981\u6b62\n\n\n1110\n\u53ef\u4ee5\n\u7981\u6b62\n\u7981\u6b62\n\u7981\u6b62\n\n\n1111\n\u53ef\u4ee5\n\u53ef\u4ee5\n\u53ef\u4ee5\n\u53ef\u4ee5\n\n\n\nSQL \u62e6\u622a\nfirewall \u6807\u7b7e\u7528\u6765\u5b9a\u4e49\u9632\u706b\u5899\uff1b firewall \u4e0b whitehost \u6807\u7b7e\u7528\u6765\u5b9a\u4e49 IP \u767d\u540d\u5355 \uff0c blacklist \u7528\u6765\u5b9a\u4e49\nSQL \u9ed1\u540d\u5355\u3002\n\n\u767d\u540d\u5355:\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u767d\u540d\u5355\uff0c \u5b9e\u73b0\u67d0\u4e3b\u673a\u67d0\u7528\u6237\u53ef\u4ee5\u8bbf\u95ee ,Mycat\u800c\u5176\u4ed6\u4e3b\u673a\u7528\u6237\u7981\u6b62\u8bbf\u95ee\u3002\n\u9ed1\u540d\u5355:\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u9ed1\u540d\u5355\uff0c \u5b9e\u73b0 Mycat \u5bf9\u5177\u4f53 SQL \u64cd\u4f5c\u7684\u62e6\u622a\uff0c \u5982\u589e\u5220\u6539\u67e5\u7b49\u64cd\u4f5c\u7684\u62e6\u622a \n\n#\u8bbe\u7f6e\u767d\u540d\u5355\n#server.xml\u914d\u7f6e\u6587\u4ef6firewall\u6807\u7b7e\n#\u914d\u7f6e\u53ea\u6709192.168.140.128\u4e3b\u673a\u53ef\u4ee5\u901a\u8fc7mycat\u7528\u6237\u8bbf\u95ee\n&lt;firewall&gt;\n    &lt;whitehost&gt;\n         &lt;host host=&quot;192.168.140.128&quot; user=&quot;mycat&quot;/&gt;\n    &lt;/whitehost&gt;\n&lt;/firewall&gt;\n\n\u7ed3\u679c\uff1a\n\u4f7f\u7528mycat\u7528\u6237\u8bbf\u95ee\u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee\uff0c\u4e3b\u673a\u6362user\u7528\u6237\u8bbf\u95ee\uff0c\u7981\u6b62\u8bbf\u95ee\n\n#\u8bbe\u7f6e\u9ed1\u540d\u5355\n#server.xml\u914d\u7f6e\u6587\u4ef6firewall\u6807\u7b7e\n#\u914d\u7f6e\u7981\u6b62mycat\u7528\u6237\u8fdb\u884c\u5220\u9664\u64cd\u4f5c\n&lt;firewall&gt;\n  &lt;whitehost&gt;\n         &lt;host host=\"192.168.2.2\" user=\"mycat\"/&gt;\n  &lt;/whitehost&gt;\n  &lt;blacklist check=\"true\"&gt;\n         &lt;property name=\"deleteAllow\"&gt;false&lt;/property&gt;\n  &lt;/blacklist&gt;\n&lt;/firewall&gt;\n\u62e6\u622a\u529f\u80fd\u5217\u8868\n\n\n\u914d\u7f6e\u9879\n\u7f3a\u7701\u503c\n\u63cf\u8ff0\n\n\n\n\nselelctAllow\ntrue\n\u662f\u5426\u5141\u8bb8\u6267\u884c SELECT \u8bed\u53e5\n\n\ndeleteAllow\ntrue\n\u662f\u5426\u5141\u8bb8\u6267\u884c DELETE \u8bed\u53e5\n\n\nupdateAllow\ntrue\n\u662f\u5426\u5141\u8bb8\u6267\u884c UPDATE \u8bed\u53e5\n\n\ninsertAllow\ntrue\n\u662f\u5426\u5141\u8bb8\u6267\u884c INSERT \u8bed\u53e5\n\n\ncreateTableAllow\ntrue\n\u662f\u5426\u5141\u8bb8\u521b\u5efa\u8868\n\n\nsetAllow\ntrue\n\u662f\u5426\u5141\u8bb8\u4f7f\u7528 SET \u8bed\u6cd5\n\n\nalterTableAllow\ntrue\n\u662f\u5426\u5141\u8bb8\u6267\u884c Alter Table \u8bed\u53e5\n\n\ndropTableAllow\ntrue\n\u662f\u5426\u5141\u8bb8\u4fee\u6539\u8868\n\n\ncommitAllow\ntrue\n\u662f\u5426\u5141\u8bb8\u6267\u884c commit \u64cd\u4f5c\n\n\nrollbackAllow\ntrue\n\u662f\u5426\u5141\u8bb8\u6267\u884c roll back \u64cd\u4f5c\n\n\n\nMycat \u76d1\u63a7\u5de5\u5177\nMycat-web \u662f Mycat \u53ef\u89c6\u5316\u8fd0\u7ef4\u7684\u7ba1\u7406\u548c\u76d1\u63a7\u5e73\u53f0\uff0c\u5f25\u8865\u4e86 Mycat \u5728\u76d1\u63a7\u4e0a\u7684\u7a7a\u767d\u3002\u5e2e Mycat \u5206\n\u62c5\u7edf\u8ba1\u4efb\u52a1\u548c\u914d\u7f6e\u7ba1\u7406\u4efb\u52a1\u3002 Mycat-web \u5f15\u5165\u4e86 ZooKeeper \u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3\uff0c\u53ef\u4ee5\u7ba1\u7406\u591a\u4e2a\u8282\u70b9\u3002\nMycat-web \u4e3b\u8981\u7ba1\u7406\u548c\u76d1\u63a7 Mycat \u7684\u6d41\u91cf\u3001\u8fde\u63a5\u3001\u6d3b\u52a8\u7ebf\u7a0b\u548c\u5185\u5b58\u7b49\uff0c\u5177\u5907 IP \u767d\u540d\u5355\u3001\u90ae\u4ef6\u544a\u8b66\u7b49\u6a21\n\u5757\uff0c\u8fd8\u53ef\u4ee5\u7edf\u8ba1 SQL \u5e76\u5206\u6790\u6162 SQL \u548c\u9ad8\u9891 SQL \u7b49\u3002\u4e3a\u4f18\u5316 SQL \u63d0\u4f9b\u4f9d\u636e \u3002\n2020-02-17_204353\n\u5b89\u88c5\u914d\u7f6e\uff1a\n1\u3001 ZooKeeper \u5b89\u88c5\n\n#1\u4e0b\u8f7d\u5b89\u88c5\u5305http://zookeeper.apache.org/\n\n#2 \u5b89\u88c5\u5305\u62f7\u8d1d\u5230Linux\u7cfb\u7edf/opt\u76ee\u5f55\u4e0b\uff0c\u5e76\u89e3\u538b\ntar -zxvf zookeeper-3.4.11.tar.gz\n\n#3 \u8fdb\u5165ZooKeeper\u89e3\u538b\u540e\u7684\u914d\u7f6e\u76ee\u5f55\uff08conf\uff09 \uff0c\u590d\u5236\u914d\u7f6e\u6587\u4ef6\u5e76\u6539\u540d\ncp zoo_sample.cfg zoo.cfg\n\n#4 \u8fdb\u5165ZooKeeper\u7684\u547d\u4ee4\u76ee\u5f55\uff08bin\uff09 \uff0c\u8fd0\u884c\u542f\u52a8\u547d\u4ee4\n./zkServer.sh start\n\n#5 ZooKeeper\u670d\u52a1\u7aef\u53e3\u4e3a2181\uff0c\u67e5\u770b\u670d\u52a1\u5df2\u7ecf\u542f\u52a8\nnetstat -ant | grep 2181\n2\u3001 Mycat-web \u5b89\u88c5\n\n#1\u4e0b\u8f7d\u5b89\u88c5\u5305http://www.mycat.io/\n\n#2 \u5b89\u88c5\u5305\u62f7\u8d1d\u5230Linux\u7cfb\u7edf/opt\u76ee\u5f55\u4e0b\uff0c\u5e76\u89e3\u538b\ntar -zxvf Mycat-web-1.0-SNAPSHOT-20170102153329-linux.tar.gz\n\n#3 \u62f7\u8d1dmycat-web\u6587\u4ef6\u5939\u5230/usr/local\u76ee\u5f55\u4e0b\ncp -r mycat-web /usr/local\n\n#4 \u8fdb\u5165mycat-web\u7684\u76ee\u5f55\u4e0b\u8fd0\u884c\u542f\u52a8\u547d\u4ee4\ncd /usr/local/mycat-web/\n./start.sh &amp;\n\n#5 Mycat-web\u670d\u52a1\u7aef\u53e3\u4e3a8082\uff0c\u67e5\u770b\u670d\u52a1\u5df2\u7ecf\u542f\u52a8\nnetstat -ant | grep 8082\n\n#6 \u901a\u8fc7\u5730\u5740\u8bbf\u95ee\u670d\u52a1\nhttp://192.168.140.127:8082/mycat/\n3\u3001 Mycat-web \u914d\u7f6e\n1 \u5148\u5728\u6ce8\u518c\u4e2d\u5fc3\u914d\u7f6eZooKeeper\u5730\u5740\uff0c\u914d\u7f6e\u540e\u5237\u65b0\u9875\u9762\n2 \u65b0\u589eMycat\u76d1\u63a7\u5b9e\u4f8b\n4.\u5176\u4ed6\u529f\u80fd\u6267\u884c\u6478\u7d22\n", "categories": [{"name": "Daily", "slug": "Daily", "permalink": "/HeapStack/category/Daily/"}], "tags": [{"name": "Travel", "slug": "Travel", "permalink": "/HeapStack/tag/Travel/"}, {"name": "Family", "slug": "Family", "permalink": "/HeapStack/tag/Family/"}]}], "pages": [{"title": "\u5173\u4e8e", "date": "2017-06-28T17:26:00-00.00", "path": "/HeapStack/about/", "text": "\u8fd9\u91cc\u662f\u6211\u7684\u4e2a\u4eba\u535a\u5ba2\uff0c\u901a\u8fc7 GitHub \u7ba1\u7406\u4e0e\u6784\u5efa\u3002\nContact\nEmail: hi#imalan.cn (replace # with @)\nTelegram\uff1aAlanDecode\n", "categories": [], "tags": []}]}