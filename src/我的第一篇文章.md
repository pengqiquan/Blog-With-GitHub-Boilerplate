---
layout: post
title: 我的第一篇文章
slug: my-first-awesome-post
date: 2019-12-17 20:34
status: publish
author: <填写你的名字>
categories: 
  - 默认分类
tags: 
  - 博客
  - GitHub
excerpt: Hello World!
---

这是我的第一篇文章。文章使用 GitHub 管理，并通过 GitHub Actions 自动构建与发布！
### 系统环境

Centos 7 x64

BootStrap JDK**: 1.8.0_191

使用Jdk1.8 来编译OpenJdk1.8  (jdk1.7也行)



```shell
[root@centos7_02 ~]# uname -a
Linux centos7_02 3.10.0-1062.9.1.el7.x86_64 #1 SMP Fri Dec 6 15:49:49 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
[root@centos7_02 ~]# java -version
openjdk version "1.8.0_232"
OpenJDK Runtime Environment (build 1.8.0_232-b09)
OpenJDK 64-Bit Server VM (build 25.232-b09, mixed mode)
```



### 准备条件

1. OpenJdk 8 的源码:openjdk-8u41-src-b04-14_jan_2020
2. ccache-3.2.4.tar.gz 的安装包

### 编译前的准备

开始前，先升级一下：

```sudo yum update```

```sudo yum upgrade```

#### 1.安装源码仓库管理工具mercurial (可选，若是采用浏览器下载源码包再上传到服务器，则可以不安装)

1. 查看可以安装的包：```yum –y list mercurial```
2. 安装：```yum install mercurial```
3. 查看安装的hg版本：```hg --d'dversion```
4. 查看已安装的 ```mercurial: yum –y installed | grep mercurial```

安装完成后，使用```hg --version```看是否成功安装



#### 2 安装相关依赖

```linux
yum -y install zlib zlib-devel

 yum -y install bzip2 bzip2-devel

 yum -y install ncurses ncurses-devel

 yum -y install readline readline-devel

 yum -y install openssl openssl-devel

 yum -y install openssl-static

 yum -y install xz lzma xz-devel

 yum -y install sqlite sqlite-devel

 yum -y install gdbm gdbm-devel

 yum -y install bzip2 bzip2-devel

 yum -y install ncurses ncurses-devel

 yum -y install readline readline-devel

 yum -y install openssl openssl-devel

 yum -y install openssl-static

 yum -y install xz lzma xz-devel

 yum -y install sqlite sqlite-devel

 yum -y install gdbm gdbm-devel

 yum -y install tk tk-devel

 yum -y install libffi-devel 

 yum groupinstall "Development Tools" 

 yum install libXtst-devel libXt-devel libXrender-devel

yum install cups-devel

sudo yum install cups-devel

sudo yum install alsa-lib-devel

yum install alsa-lib-devel cups-devel libX* gcc gcc-c++ freetype-devel libstdc++-static ant make

```

 

##### 2.1 安装JDK1.8(若有，则无需安装) 

```java
yum install java-1.8.0-openjdk  java-1.8.0-openjdk-devel
或者安装jdk1.7也行
yum install java-1.7.0-openjdk  java-1.7.0-openjdk-devel
```

查看版本：

```shell
[root@centos7_02 ~]# java -version
openjdk version "1.8.0_242"
OpenJDK Runtime Environment (build 1.8.0_242-b08)
OpenJDK 64-Bit Server VM (build 25.242-b08, mixed mode)
```



##### 2.2 安装ccache

ccache不能用yum形式安装，所以，使用源码包来编译安装。建议使用**root**用户来完成，否则会有权限问题。

```shell
cd /opt
wget http://samba.org/ftp/ccache/ccache-3.2.4.tar.gz
tar -zxf ccache-3.2.4.tar.gz
mkdir /usr/local/ccache-3.2.4/
cd /usr/local/ccache-3.2.4/
/opt/ccache-3.2.4/configure -prefix=/usr/local/ccache-3.2.4
make -j8
make install
cd /usr/bin
mv ccache ccache_bk    #移除原有的，防止原来存在ccache而导致问题
ln -s /usr/local/ccache-3.2.4/bin/ccache ccache
ccache --v
```



#### 3.下载源码(等待时间比较长)

```shell
mkdir /root/workspace
cd /root/workspace
hg clone http://hg.openjdk.java.net/jdk8u/jdk8u openjdk8
cd openjdk8
sh get_source.sh 
```

**如果出现下面的这行提示，表示下载源码的过程中出现了一些意外，重新执行下载的那个命令，直到将源代码下载下来,否则后续会出现各种问题**



#### 4. 开始编译安装

```shell
cd /root/workspace/openjdk8
chmod +x configure 
./configure 
make clean #（多次编译，清除之前的数据）
make
```

#### 5.测试结果

编写java代码

```java
cd   /root/workspace
vim test.java
```

test.java

```java
public class JvmTest {  
 public static void main(String[] args) {  
    System.out.println(System.getProperty("java.version"));  
    System.out.println(System.getProperty("os.name"));  
    System.out.println(System.getProperty("java.vendor.url"));  
   }  
}
```

不能直接javac来编译java代码，因为系统自带jdk，所以这么用会使用系统的java环境。应该这么用，javac应该使用编译后的javac

即是：

```java
编译后的javac的所在目录/javac    test.java
编译后的java的所在目录/java    test
```

输出结果。说明编译成功。

